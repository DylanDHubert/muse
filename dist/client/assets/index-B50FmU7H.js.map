{"version":3,"file":"index-B50FmU7H.js","sources":["../../../src/client/game/scenes/Boot.ts","../../../src/client/game/scenes/GameOver.ts","../../../src/client/game/config/GameConstants.ts","../../../src/client/game/audio/AudioManager.ts","../../../src/client/game/input/InputManager.ts","../../../src/client/game/platform/PlatformManager.ts","../../../src/client/game/scenes/MuseRunnerGame.ts","../../../src/client/game/scenes/MainMenu.ts","../../../src/client/game/scenes/Preloader.ts","../../../src/client/game/main.ts","../../../src/client/main.ts"],"sourcesContent":["import { Scene } from \"phaser\";\n\nexport class Boot extends Scene {\n  constructor() {\n    super(\"Boot\");\n  }\n\n  preload() {\n    //  The Boot Scene is typically used to load in any assets you require for your Preloader, such as a game logo or background.\n    //  The smaller the file size of the assets, the better, as the Boot Scene itself has no preloader.\n\n    this.load.image(\"background\", \"assets/bg.png\");\n  }\n\n  create() {\n    this.scene.start(\"Preloader\");\n  }\n}\n","import { Scene } from \"phaser\";\nimport * as Phaser from \"phaser\";\n\nexport class GameOver extends Scene {\n  camera: Phaser.Cameras.Scene2D.Camera;\n  background: Phaser.GameObjects.Image;\n  gameover_text: Phaser.GameObjects.Text;\n\n  constructor() {\n    super(\"GameOver\");\n  }\n\n  create() {\n    // Configure camera\n    this.camera = this.cameras.main;\n    this.camera.setBackgroundColor(0xff0000);\n\n    // Background â€“ create once, full-screen\n    this.background = this.add\n      .image(0, 0, \"background\")\n      .setOrigin(0)\n      .setAlpha(0.5);\n\n    // \"Game Over\" text â€“ created once and scaled responsively\n    this.gameover_text = this.add\n      .text(0, 0, \"Game Over\", {\n        fontFamily: \"Arial Black\",\n        fontSize: \"64px\",\n        color: \"#ffffff\",\n        stroke: \"#000000\",\n        strokeThickness: 8,\n        align: \"center\",\n      })\n      .setOrigin(0.5);\n\n    // Initial responsive layout\n    this.updateLayout(this.scale.width, this.scale.height);\n\n    // Update layout on canvas resize / orientation change\n    this.scale.on(\"resize\", (gameSize: Phaser.Structs.Size) => {\n      const { width, height } = gameSize;\n      this.updateLayout(width, height);\n    });\n\n    // Return to Main Menu on tap / click\n    this.input.once(\"pointerdown\", () => {\n      this.scene.start(\"MainMenu\");\n    });\n  }\n\n  private updateLayout(width: number, height: number): void {\n    // Resize camera viewport to prevent black bars\n    this.cameras.resize(width, height);\n\n    // Stretch background to fill entire screen\n    if (this.background) {\n      this.background.setDisplaySize(width, height);\n    }\n\n    // Compute scale factor (never enlarge above 1Ã—)\n    const scaleFactor = Math.min(Math.min(width / 1024, height / 768), 1);\n\n    // Centre and scale the game-over text\n    if (this.gameover_text) {\n      this.gameover_text.setPosition(width / 2, height / 2);\n      this.gameover_text.setScale(scaleFactor);\n    }\n  }\n}\n","// Type aliases for better readability\nexport type GameKey = \"S\" | \"D\" | \"F\" | \"G\" | \"H\" | \"J\" | \"K\";\n\n// Centralized game configuration constants\nexport const GAME_CONSTANTS = {\n  // Character configuration\n  CHARACTER: {\n    SPEED: 100,\n    WIDTH: 30,\n    HEIGHT: 40,\n    COLOR: 0x3498db,\n    VISUAL_FEEDBACK_COLOR: 0xf39c12,\n    VISUAL_FEEDBACK_DURATION: 200,\n  },\n\n  // Platform configuration\n  PLATFORMS: {\n    WIDTH: 120,\n    HEIGHT: 20,\n    EXTENSION_DISTANCE: 150,\n    AHEAD_OFFSET: 20,\n    CENTER_OFFSET: 80,\n    CLEANUP_DISTANCE: 400,\n  },\n\n  // Audio configuration\n  AUDIO: {\n    NOTE_DURATION: 0.5,\n    ATTACK_TIME: 0.01,\n    VOLUME: 0.3,\n  },\n\n  // Game mechanics\n  GAME: {\n    OVER_FALL_DISTANCE: 300,\n    SCORE_PER_PLATFORM: 10,\n    GROUND_OFFSET: 60,\n    CHARACTER_HEIGHT_LERP_SPEED: 0.08,\n    FALL_VELOCITY: 300,\n  },\n\n  // Level heights for each key (relative to camera height)\n  LEVEL_HEIGHTS: {\n    S: -80, // Ground level offset\n    D: -120, // Level 2 offset\n    F: -160, // Level 3 offset\n    G: -200, // Level 4 offset\n    H: -240, // Level 5 offset\n    J: -280, // Level 6 offset\n    K: -320, // Highest level offset\n  } as Record<GameKey, number>,\n\n  // Level colors for each key\n  LEVEL_COLORS: {\n    S: 0xe74c3c, // Red (lowest)\n    D: 0xf39c12, // Orange\n    F: 0xf1c40f, // Yellow\n    G: 0x2ecc71, // Green\n    H: 0x3498db, // Blue\n    J: 0x9b59b6, // Purple\n    K: 0xe91e63, // Pink (highest)\n  } as Record<GameKey, number>,\n\n  // Valid game keys\n  VALID_KEYS: [\"S\", \"D\", \"F\", \"G\", \"H\", \"J\", \"K\"] as readonly GameKey[],\n} as const;\n","import { GAME_CONSTANTS, GameKey } from \"../config/GameConstants\";\n\n// Note frequencies for each game key (C major scale)\nconst NOTE_FREQUENCIES: Record<GameKey, number> = {\n  S: 261.63, // C4\n  D: 293.66, // D4\n  F: 329.63, // E4\n  G: 349.23, // F4\n  H: 392.0, // G4\n  J: 440.0, // A4\n  K: 493.88, // B4\n};\n\nexport interface IAudioManager {\n  initialize(): void;\n  playNote(key: GameKey): void;\n  isAudioAvailable(): boolean;\n}\n\nexport class AudioManager implements IAudioManager {\n  private audioContext: AudioContext | null = null;\n  private isInitialized: boolean = false;\n  private audioAvailable: boolean = false;\n\n  initialize(): void {\n    try {\n      // Initialize Web Audio API context\n      this.audioContext = new (window.AudioContext ||\n        (window as unknown as { webkitAudioContext: typeof AudioContext })\n          .webkitAudioContext)();\n      this.audioAvailable = true;\n      this.isInitialized = true;\n      console.log(\"AudioManager initialized successfully\");\n    } catch (error) {\n      console.warn(\"Web Audio API not available:\", error);\n      this.audioAvailable = false;\n      this.isInitialized = true;\n    }\n  }\n\n  playNote(key: GameKey): void {\n    if (!this.isInitialized) {\n      console.warn(\"AudioManager not initialized\");\n      return;\n    }\n\n    if (!this.audioAvailable || !this.audioContext) {\n      // Graceful degradation - audio not available\n      return;\n    }\n\n    const frequency = NOTE_FREQUENCIES[key];\n    if (!frequency) {\n      console.warn(`Unknown key: ${key}`);\n      return;\n    }\n\n    try {\n      this.playMusicalTone(frequency);\n    } catch (error) {\n      console.warn(\"Failed to play note:\", error);\n    }\n  }\n\n  isAudioAvailable(): boolean {\n    return this.audioAvailable;\n  }\n\n  private playMusicalTone(frequency: number): void {\n    if (!this.audioContext) return;\n\n    // Create oscillator for the musical note\n    const oscillator = this.audioContext.createOscillator();\n    const gainNode = this.audioContext.createGain();\n\n    oscillator.connect(gainNode);\n    gainNode.connect(this.audioContext.destination);\n\n    // Set frequency and type\n    oscillator.frequency.setValueAtTime(\n      frequency,\n      this.audioContext.currentTime,\n    );\n    oscillator.type = \"sine\"; // Pure tone\n\n    // Set volume envelope (attack and decay)\n    gainNode.gain.setValueAtTime(0, this.audioContext.currentTime);\n    gainNode.gain.linearRampToValueAtTime(\n      GAME_CONSTANTS.AUDIO.VOLUME,\n      this.audioContext.currentTime + GAME_CONSTANTS.AUDIO.ATTACK_TIME,\n    );\n    gainNode.gain.exponentialRampToValueAtTime(\n      0.01,\n      this.audioContext.currentTime + GAME_CONSTANTS.AUDIO.NOTE_DURATION,\n    );\n\n    // Play the note\n    oscillator.start(this.audioContext.currentTime);\n    oscillator.stop(\n      this.audioContext.currentTime + GAME_CONSTANTS.AUDIO.NOTE_DURATION,\n    );\n  }\n}\n","import { Scene } from \"phaser\";\nimport { GAME_CONSTANTS, GameKey } from \"../config/GameConstants\";\n\nexport interface IInputManager {\n  initialize(): void;\n  update(currentTime: number): { keyStateChanged: boolean };\n  getInputState(): { pressedKeys: Set<string> };\n}\n\nexport class InputManager implements IInputManager {\n  private scene: Scene;\n  private currentlyPressedKeys: Set<string> = new Set();\n  private previouslyPressedKeys: Set<string> = new Set();\n  private isInitialized: boolean = false;\n\n  constructor(scene: Scene) {\n    this.scene = scene;\n  }\n\n  initialize(): void {\n    if (!this.scene.input.keyboard) {\n      console.warn(\"Keyboard input not available\");\n      return;\n    }\n\n    this.isInitialized = true;\n    console.log(\"InputManager initialized successfully\");\n  }\n\n  update(_currentTime: number): { keyStateChanged: boolean } {\n    if (!this.isInitialized || !this.scene.input.keyboard) {\n      return { keyStateChanged: false };\n    }\n\n    // Store previous state\n    this.previouslyPressedKeys = new Set(this.currentlyPressedKeys);\n\n    // Clear current state\n    this.currentlyPressedKeys.clear();\n\n    // Check each valid game key\n    GAME_CONSTANTS.VALID_KEYS.forEach((key) => {\n      const keyObject = this.scene.input.keyboard!.addKey(key);\n      if (keyObject.isDown) {\n        this.currentlyPressedKeys.add(key);\n      }\n    });\n\n    // Determine if key state changed\n    const keyStateChanged = this.hasKeyStateChanged();\n\n    return { keyStateChanged };\n  }\n\n  getInputState(): { pressedKeys: Set<string> } {\n    return {\n      pressedKeys: new Set(this.currentlyPressedKeys),\n    };\n  }\n\n  private hasKeyStateChanged(): boolean {\n    // Check if the sets are different\n    if (this.currentlyPressedKeys.size !== this.previouslyPressedKeys.size) {\n      return true;\n    }\n\n    // Check if any key in current set is not in previous set\n    for (const key of this.currentlyPressedKeys) {\n      if (!this.previouslyPressedKeys.has(key)) {\n        return true;\n      }\n    }\n\n    // Check if any key in previous set is not in current set\n    for (const key of this.previouslyPressedKeys) {\n      if (!this.currentlyPressedKeys.has(key)) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  // Helper method to check if a key is a valid game key\n  isValidGameKey(key: string): key is GameKey {\n    return GAME_CONSTANTS.VALID_KEYS.includes(key as GameKey);\n  }\n}\n","import { Scene } from \"phaser\";\nimport * as Phaser from \"phaser\";\nimport { GAME_CONSTANTS, GameKey } from \"../config/GameConstants\";\n\ninterface PlatformData {\n  rectangle: Phaser.GameObjects.Rectangle;\n  startX: number;\n  key: GameKey;\n}\n\nexport interface IPlatformManager {\n  initialize(): void;\n  startNewPlatform(key: GameKey, startX: number): void;\n  endPlatform(key: GameKey): void;\n  extendActivePlatforms(characterX: number): void;\n  getHighestActiveKey(): GameKey | null;\n  hasActivePlatforms(): boolean;\n  cleanupOldPlatforms(characterX: number): void;\n  getActivePlatforms(): Map<string, PlatformData>;\n  getPlatformsGroup(): Phaser.GameObjects.Group;\n}\n\nexport class PlatformManager implements IPlatformManager {\n  private scene: Scene;\n  private activePlatforms: Map<string, PlatformData> = new Map();\n  private platformsGroup: Phaser.GameObjects.Group;\n  private isInitialized: boolean = false;\n\n  constructor(scene: Scene) {\n    this.scene = scene;\n    this.platformsGroup = this.scene.add.group();\n  }\n\n  initialize(): void {\n    this.isInitialized = true;\n    console.log(\"PlatformManager initialized successfully\");\n  }\n\n  startNewPlatform(key: GameKey, startX: number): void {\n    if (!this.isInitialized) {\n      console.warn(\"PlatformManager not initialized\");\n      return;\n    }\n\n    // Don't create duplicate platforms for the same key\n    if (this.activePlatforms.has(key)) {\n      return;\n    }\n\n    const { height } = this.scene.cameras.main;\n    const platformY = height + GAME_CONSTANTS.LEVEL_HEIGHTS[key];\n    const platformColor = GAME_CONSTANTS.LEVEL_COLORS[key];\n\n    // Create platform rectangle\n    const platform = this.scene.add.rectangle(\n      startX +\n        GAME_CONSTANTS.PLATFORMS.AHEAD_OFFSET +\n        GAME_CONSTANTS.PLATFORMS.CENTER_OFFSET,\n      platformY,\n      GAME_CONSTANTS.PLATFORMS.WIDTH,\n      GAME_CONSTANTS.PLATFORMS.HEIGHT,\n      platformColor,\n    );\n\n    // Add to physics (optional, for future collision detection)\n    this.scene.physics.add.existing(platform, true); // true = static body\n\n    // Store platform data\n    const platformData: PlatformData = {\n      rectangle: platform,\n      startX: startX,\n      key: key,\n    };\n\n    this.activePlatforms.set(key, platformData);\n    this.platformsGroup.add(platform);\n\n    console.log(`Created platform for key ${key} at height ${platformY}`);\n  }\n\n  endPlatform(key: GameKey): void {\n    const platformData = this.activePlatforms.get(key);\n    if (!platformData) {\n      return;\n    }\n\n    // Remove from active platforms but keep the visual platform\n    this.activePlatforms.delete(key);\n    console.log(`Ended platform for key ${key}`);\n  }\n\n  extendActivePlatforms(characterX: number): void {\n    this.activePlatforms.forEach((platformData, _key) => {\n      const platform = platformData.rectangle;\n      const targetRightEdge =\n        characterX + GAME_CONSTANTS.PLATFORMS.EXTENSION_DISTANCE;\n      const currentRightEdge = platform.x + platform.width / 2;\n\n      if (targetRightEdge > currentRightEdge) {\n        // Extend platform by increasing width and adjusting position\n        const newWidth = targetRightEdge - (platform.x - platform.width / 2);\n        const newCenterX = platform.x - platform.width / 2 + newWidth / 2;\n\n        platform.setSize(newWidth, platform.height);\n        platform.setPosition(newCenterX, platform.y);\n      }\n    });\n  }\n\n  getHighestActiveKey(): GameKey | null {\n    if (this.activePlatforms.size === 0) {\n      return null;\n    }\n\n    // Find the key with the highest level (lowest Y value)\n    let highestKey: GameKey | null = null;\n    let highestY = Number.POSITIVE_INFINITY;\n\n    this.activePlatforms.forEach((_platformData, key) => {\n      const levelHeight = GAME_CONSTANTS.LEVEL_HEIGHTS[key as GameKey];\n      if (levelHeight < highestY) {\n        highestY = levelHeight;\n        highestKey = key as GameKey;\n      }\n    });\n\n    return highestKey;\n  }\n\n  hasActivePlatforms(): boolean {\n    return this.activePlatforms.size > 0;\n  }\n\n  cleanupOldPlatforms(characterX: number): void {\n    const platformsToRemove: Phaser.GameObjects.Rectangle[] = [];\n\n    // Check all platforms in the group, not just active ones\n    this.platformsGroup.children.entries.forEach((platform) => {\n      const rect = platform as Phaser.GameObjects.Rectangle;\n      const platformRightEdge = rect.x + rect.width / 2;\n\n      // Remove platforms that are far behind the character\n      if (\n        platformRightEdge <\n        characterX - GAME_CONSTANTS.PLATFORMS.CLEANUP_DISTANCE\n      ) {\n        platformsToRemove.push(rect);\n      }\n    });\n\n    // Remove old platforms\n    platformsToRemove.forEach((platform) => {\n      this.platformsGroup.remove(platform);\n      platform.destroy();\n    });\n\n    if (platformsToRemove.length > 0) {\n      console.log(`Cleaned up ${platformsToRemove.length} old platforms`);\n    }\n  }\n\n  getActivePlatforms(): Map<string, PlatformData> {\n    return new Map(this.activePlatforms);\n  }\n\n  getPlatformsGroup(): Phaser.GameObjects.Group {\n    return this.platformsGroup;\n  }\n\n  // Helper method to get level height for a key\n  getLevelHeight(key: GameKey): number {\n    return GAME_CONSTANTS.LEVEL_HEIGHTS[key];\n  }\n\n  // Helper method to get level color for a key\n  getLevelColor(key: GameKey): number {\n    return GAME_CONSTANTS.LEVEL_COLORS[key];\n  }\n}\n","import { Scene } from \"phaser\";\nimport * as Phaser from \"phaser\";\nimport { AudioManager } from \"../audio/AudioManager\";\nimport { InputManager } from \"../input/InputManager\";\nimport { PlatformManager } from \"../platform/PlatformManager\";\nimport { GAME_CONSTANTS, GameKey } from \"../config/GameConstants\";\n\nexport class MuseRunnerGame extends Scene {\n  private character!: Phaser.GameObjects.Rectangle;\n  private scoreText!: Phaser.GameObjects.Text;\n\n  // Game state\n  private isGameRunning: boolean = false;\n  private score: number = 0;\n\n  // Managers\n  private audioManager!: AudioManager;\n  private inputManager!: InputManager;\n  private platformManager!: PlatformManager;\n\n  constructor() {\n    super(\"MuseRunnerGame\");\n  }\n\n  async create(): Promise<void> {\n    const { width, height } = this.cameras.main;\n\n    // Initialize managers with error handling\n    try {\n      this.audioManager = new AudioManager();\n      this.inputManager = new InputManager(this);\n      this.platformManager = new PlatformManager(this);\n\n      // Initialize managers with error handling\n      this.audioManager.initialize();\n      this.inputManager.initialize();\n      this.platformManager.initialize();\n\n      console.log(\"All managers initialized successfully\");\n    } catch (error) {\n      console.error(\"Failed to initialize managers:\", error);\n      // Game can still continue with degraded functionality\n    }\n\n    // Create character (blue rectangle) - positioned on the neutral platform\n    this.character = this.add.rectangle(\n      100,\n      height - 80,\n      GAME_CONSTANTS.CHARACTER.WIDTH,\n      GAME_CONSTANTS.CHARACTER.HEIGHT,\n      GAME_CONSTANTS.CHARACTER.COLOR,\n    );\n    this.physics.add.existing(this.character);\n    const characterBody = this.character.body as Phaser.Physics.Arcade.Body;\n\n    // Set up physics for endless running - no collision needed\n    characterBody.setCollideWorldBounds(false);\n    characterBody.setDragX(0);\n    characterBody.setFrictionX(0);\n    characterBody.setGravityY(0); // No gravity - character rides platforms directly\n\n    // Create UI\n    this.scoreText = this.add.text(16, 16, \"Score: 0\", {\n      fontSize: \"24px\",\n      color: \"#ffffff\",\n    });\n\n    // Instructions\n    const instructionText = this.add\n      .text(\n        width / 2,\n        30,\n        \"ðŸŽµ Press S-D-F-G-H-J-K to create platforms at different heights! ðŸŽµ\",\n        {\n          fontSize: \"16px\",\n          color: \"#ecf0f1\",\n          fontFamily: \"Arial, sans-serif\",\n        },\n      )\n      .setOrigin(0.5);\n\n    // Key guide\n    this.add\n      .text(width / 2, 60, \"S=Low â†’ D â†’ F â†’ G â†’ H â†’ J â†’ K=High\", {\n        fontSize: \"14px\",\n        color: \"#95a5a6\",\n        fontFamily: \"Arial, sans-serif\",\n      })\n      .setOrigin(0.5);\n\n    // Make instructions pulse to draw attention\n    this.tweens.add({\n      targets: instructionText,\n      alpha: 0.6,\n      duration: 1500,\n      yoyo: true,\n      repeat: -1,\n    });\n\n    // Controls info\n    this.add\n      .text(width - 16, 16, \"v0.0.4 | ESC: Menu | R: Restart\", {\n        fontSize: \"14px\",\n        color: \"#95a5a6\",\n      })\n      .setOrigin(1, 0);\n\n    // ESC key to return to menu\n    this.input.keyboard!.on(\"keydown-ESC\", () => {\n      this.scene.start(\"MainMenu\");\n    });\n\n    // R key to restart\n    this.input.keyboard!.on(\"keydown-R\", () => {\n      this.scene.restart();\n    });\n\n    // Start the game\n    this.isGameRunning = true;\n\n    // Camera follows character\n    this.cameras.main.startFollow(this.character, true, 0.1, 0.1);\n    this.cameras.main.setDeadzone(200, 100);\n\n    // Reset game state\n    this.score = 0;\n\n    // Don't start with any musical platform - wait for first key press\n  }\n\n  override update(): void {\n    if (!this.isGameRunning) return;\n\n    // Auto-run character forward - ALWAYS moving, never stops\n    const characterBody = this.character.body as Phaser.Physics.Arcade.Body;\n\n    // Force constant forward movement - override any physics that might stop it\n    characterBody.setVelocityX(GAME_CONSTANTS.CHARACTER.SPEED);\n    characterBody.setDragX(0); // No drag to slow down\n    characterBody.setFrictionX(0); // No friction from platforms\n\n    // Handle input for multiple simultaneous keys with error handling\n    try {\n      const { keyStateChanged } = this.inputManager.update(this.time.now);\n      const inputState = this.inputManager.getInputState();\n\n      if (keyStateChanged) {\n        this.handleKeyChanges(inputState.pressedKeys);\n      }\n    } catch (error) {\n      console.warn(\"Input handling error:\", error);\n    }\n\n    // Extend all active platforms as character moves with error handling\n    try {\n      if (this.platformManager.hasActivePlatforms()) {\n        this.platformManager.extendActivePlatforms(this.character.x);\n      }\n    } catch (error) {\n      console.warn(\"Platform extension error:\", error);\n    }\n\n    // Make character ride the highest active platform with error handling\n    try {\n      this.updateCharacterHeight();\n    } catch (error) {\n      console.warn(\"Character height update error:\", error);\n    }\n\n    // Debug: Log character position periodically\n    if (Math.floor(this.character.x) % 500 === 0) {\n      console.log(\n        `Character at X: ${this.character.x}, Y: ${this.character.y}, Game running: ${this.isGameRunning}`,\n      );\n    }\n\n    // Game over condition - only if character falls WAY off screen (make it more lenient)\n    if (\n      this.character.y >\n      this.cameras.main.height + GAME_CONSTANTS.GAME.OVER_FALL_DISTANCE\n    ) {\n      console.log(\"Game over triggered - character fell too far\");\n      this.gameOver();\n    }\n\n    // Clean up old platforms through platform manager with error handling\n    try {\n      this.platformManager.cleanupOldPlatforms(this.character.x);\n    } catch (error) {\n      console.warn(\"Platform cleanup error:\", error);\n    }\n  }\n\n  private handleKeyChanges(currentlyPressedKeys: Set<string>): void {\n    try {\n      const activePlatforms = this.platformManager.getActivePlatforms();\n\n      // Start new platforms for newly pressed keys\n      currentlyPressedKeys.forEach((key) => {\n        if (this.isValidGameKey(key) && !activePlatforms.has(key)) {\n          try {\n            this.platformManager.startNewPlatform(key, this.character.x);\n            this.audioManager.playNote(key);\n            console.log(`Started platform for ${key}`);\n\n            // Visual feedback - change character color briefly\n            this.character.setFillStyle(\n              GAME_CONSTANTS.CHARACTER.VISUAL_FEEDBACK_COLOR,\n            );\n            this.time.delayedCall(\n              GAME_CONSTANTS.CHARACTER.VISUAL_FEEDBACK_DURATION,\n              () => {\n                this.character.setFillStyle(GAME_CONSTANTS.CHARACTER.COLOR); // Back to blue\n              },\n            );\n\n            this.score += GAME_CONSTANTS.GAME.SCORE_PER_PLATFORM;\n            this.scoreText.setText(`Score: ${Math.floor(this.score)}`);\n          } catch (error) {\n            console.warn(`Failed to start platform for key ${key}:`, error);\n          }\n        }\n      });\n\n      // End platforms for released keys\n      activePlatforms.forEach((_platformData, key) => {\n        if (!currentlyPressedKeys.has(key)) {\n          try {\n            this.platformManager.endPlatform(key as GameKey);\n            console.log(`Ended platform for ${key}`);\n          } catch (error) {\n            console.warn(`Failed to end platform for key ${key}:`, error);\n          }\n        }\n      });\n    } catch (error) {\n      console.error(\"Key change handling error:\", error);\n    }\n  }\n\n  private isValidGameKey(key: string): key is GameKey {\n    return GAME_CONSTANTS.VALID_KEYS.includes(key as GameKey);\n  }\n\n  private updateCharacterHeight(): void {\n    const characterBody = this.character.body as Phaser.Physics.Arcade.Body;\n\n    // Get the highest active key to determine target height\n    const highestKey = this.platformManager.getHighestActiveKey();\n\n    if (highestKey) {\n      // Calculate target Y based on the highest active key\n      const { height } = this.cameras.main;\n      const targetY = height + GAME_CONSTANTS.LEVEL_HEIGHTS[highestKey] - 10;\n      const currentY = this.character.y;\n      const heightDiff = targetY - currentY;\n\n      // Very smooth transition with slower lerp\n      if (Math.abs(heightDiff) > 0.5) {\n        // Use slower lerp for ultra-smooth movement\n        const newY = Phaser.Math.Linear(\n          currentY,\n          targetY,\n          GAME_CONSTANTS.GAME.CHARACTER_HEIGHT_LERP_SPEED,\n        );\n        this.character.y = newY;\n        characterBody.setVelocityY(0); // Override physics velocity\n      } else {\n        // Close enough, lock to platform\n        this.character.y = targetY;\n        characterBody.setVelocityY(0);\n      }\n    } else {\n      // No active platforms - fall down smoothly to ground\n      const { height } = this.cameras.main;\n      const groundY = height - GAME_CONSTANTS.GAME.GROUND_OFFSET;\n\n      if (this.character.y < groundY) {\n        characterBody.setVelocityY(GAME_CONSTANTS.GAME.FALL_VELOCITY); // Fall down\n      } else {\n        this.character.y = groundY; // Hit ground\n        characterBody.setVelocityY(0);\n      }\n    }\n  }\n\n  private gameOver(): void {\n    this.isGameRunning = false;\n\n    const { width, height } = this.cameras.main;\n\n    // Stop camera follow\n    this.cameras.main.stopFollow();\n\n    // Game over screen\n    const gameOverBg = this.add.rectangle(\n      this.cameras.main.scrollX + width / 2,\n      this.cameras.main.scrollY + height / 2,\n      width,\n      height,\n      0x000000,\n      0.8,\n    );\n    gameOverBg.setScrollFactor(0);\n\n    this.add\n      .text(\n        this.cameras.main.scrollX + width / 2,\n        this.cameras.main.scrollY + height / 2 - 80,\n        \"Game Over!\",\n        {\n          fontSize: \"48px\",\n          color: \"#e74c3c\",\n          fontFamily: \"Arial, sans-serif\",\n        },\n      )\n      .setOrigin(0.5)\n      .setScrollFactor(0);\n\n    this.add\n      .text(\n        this.cameras.main.scrollX + width / 2,\n        this.cameras.main.scrollY + height / 2 - 20,\n        `Final Score: ${Math.floor(this.score)}`,\n        {\n          fontSize: \"24px\",\n          color: \"#ffffff\",\n          fontFamily: \"Arial, sans-serif\",\n        },\n      )\n      .setOrigin(0.5)\n      .setScrollFactor(0);\n\n    const restartText = this.add\n      .text(\n        this.cameras.main.scrollX + width / 2,\n        this.cameras.main.scrollY + height / 2 + 30,\n        \"Press R to restart or ESC for menu\",\n        {\n          fontSize: \"18px\",\n          color: \"#bdc3c7\",\n          fontFamily: \"Arial, sans-serif\",\n        },\n      )\n      .setOrigin(0.5)\n      .setScrollFactor(0);\n\n    // Pulsing restart text\n    this.tweens.add({\n      targets: restartText,\n      alpha: 0.5,\n      duration: 1000,\n      yoyo: true,\n      repeat: -1,\n    });\n\n    // Send score to parent (Reddit)\n    if (window.parent) {\n      window.parent.postMessage(\n        {\n          type: \"GAME_OVER\",\n          data: { finalScore: Math.floor(this.score) },\n        },\n        \"*\",\n      );\n    }\n  }\n}\n","import { Scene, GameObjects } from \"phaser\";\n\nexport class MainMenu extends Scene {\n  private title: GameObjects.Text | null = null;\n  private subtitle: GameObjects.Text | null = null;\n  private instructions: GameObjects.Text | null = null;\n  private startText: GameObjects.Text | null = null;\n  private credits: GameObjects.Text | null = null;\n\n  constructor() {\n    super(\"MainMenu\");\n  }\n\n  init(): void {\n    this.title = null;\n    this.subtitle = null;\n    this.instructions = null;\n    this.startText = null;\n    this.credits = null;\n  }\n\n  create() {\n    this.refreshLayout();\n\n    // Re-calculate positions whenever the game canvas is resized\n    this.scale.on(\"resize\", () => this.refreshLayout());\n\n    // Start game on click or space\n    this.input.once(\"pointerdown\", () => {\n      this.scene.start(\"MuseRunnerGame\");\n    });\n\n    this.input.keyboard!.on(\"keydown-SPACE\", () => {\n      this.scene.start(\"MuseRunnerGame\");\n    });\n  }\n\n  private refreshLayout(): void {\n    const { width, height } = this.scale;\n\n    // Resize camera to new viewport\n    this.cameras.resize(width, height);\n\n    // Background\n    this.add.rectangle(width / 2, height / 2, width, height, 0x2c3e50);\n\n    // Scale factor for responsive design\n    const scaleFactor = Math.min(width / 1024, height / 768);\n\n    // Title\n    if (!this.title) {\n      this.title = this.add\n        .text(0, 0, \"ðŸŽµ Muse Runner ðŸƒâ€â™‚ï¸\", {\n          fontSize: \"48px\",\n          color: \"#ffffff\",\n          fontFamily: \"Arial, sans-serif\",\n        })\n        .setOrigin(0.5);\n    }\n    this.title.setPosition(width / 2, height / 3);\n    this.title.setScale(scaleFactor);\n\n    // Subtitle\n    if (!this.subtitle) {\n      this.subtitle = this.add\n        .text(0, 0, \"Rhythm Platformer\", {\n          fontSize: \"24px\",\n          color: \"#3498db\",\n          fontFamily: \"Arial, sans-serif\",\n        })\n        .setOrigin(0.5);\n    }\n    this.subtitle.setPosition(width / 2, height / 3 + 60 * scaleFactor);\n    this.subtitle.setScale(scaleFactor);\n\n    // Instructions\n    if (!this.instructions) {\n      this.instructions = this.add\n        .text(\n          0,\n          0,\n          \"Control your character by playing musical notes!\\n\\nPress S-D-F-G-H-J-K keys to create platforms\\nKeep your character from falling off the screen\",\n          {\n            fontSize: \"18px\",\n            color: \"#ecf0f1\",\n            fontFamily: \"Arial, sans-serif\",\n            align: \"center\",\n          },\n        )\n        .setOrigin(0.5);\n    }\n    this.instructions.setPosition(width / 2, height / 2);\n    this.instructions.setScale(scaleFactor);\n\n    // Start button text\n    if (!this.startText) {\n      this.startText = this.add\n        .text(0, 0, \"Click to Start or Press SPACE\", {\n          fontSize: \"24px\",\n          color: \"#2ecc71\",\n          fontFamily: \"Arial, sans-serif\",\n        })\n        .setOrigin(0.5);\n\n      // Pulsing effect\n      this.tweens.add({\n        targets: this.startText,\n        alpha: 0.5,\n        duration: 1000,\n        yoyo: true,\n        repeat: -1,\n      });\n    }\n    this.startText.setPosition(width / 2, height * 0.75);\n    this.startText.setScale(scaleFactor);\n\n    // Version info\n    if (!this.credits) {\n      this.credits = this.add\n        .text(\n          0,\n          0,\n          \"v0.0.4 - Built with Phaser.js for Reddit's Community Games Challenge\",\n          {\n            fontSize: \"14px\",\n            color: \"#95a5a6\",\n            fontFamily: \"Arial, sans-serif\",\n          },\n        )\n        .setOrigin(0.5);\n    }\n    this.credits.setPosition(width / 2, height - 40);\n    this.credits.setScale(scaleFactor * 0.8);\n  }\n}\n","import { Scene } from \"phaser\";\n\nexport class Preloader extends Scene {\n  constructor() {\n    super(\"Preloader\");\n  }\n\n  init() {\n    //  We loaded this image in our Boot Scene, so we can display it here\n    this.add.image(512, 384, \"background\");\n\n    //  A simple progress bar. This is the outline of the bar.\n    this.add.rectangle(512, 384, 468, 32).setStrokeStyle(1, 0xffffff);\n\n    //  This is the progress bar itself. It will increase in size from the left based on the % of progress.\n    const bar = this.add.rectangle(512 - 230, 384, 4, 28, 0xffffff);\n\n    //  Use the 'progress' event emitted by the LoaderPlugin to update the loading bar\n    this.load.on(\"progress\", (progress: number) => {\n      //  Update the progress bar (our bar is 464px wide, so 100% = 464px)\n      bar.width = 4 + 460 * progress;\n    });\n  }\n\n  preload() {\n    //  Load the assets for the game - Replace with your own assets\n    this.load.setPath(\"assets\");\n\n    this.load.image(\"logo\", \"logo.png\");\n\n    // Assets loaded - spark texture removed to fix freezing issue\n  }\n\n  create() {\n    //  When all the assets have loaded, it's often worth creating global objects here that the rest of the game can use.\n    //  For example, you can define global animations here, so we can use them in other scenes.\n\n    //  Move to the MainMenu. You could also swap this for a Scene Transition, such as a camera fade.\n    this.scene.start(\"MainMenu\");\n  }\n}\n","import { Boot } from \"./scenes/Boot\";\nimport { GameOver } from \"./scenes/GameOver\";\nimport { MuseRunnerGame } from \"./scenes/MuseRunnerGame\";\nimport { MainMenu } from \"./scenes/MainMenu\";\nimport * as Phaser from \"phaser\";\nimport { AUTO, Game } from \"phaser\";\nimport { Preloader } from \"./scenes/Preloader\";\n\n//  Muse Runner - Rhythm Platformer Game Configuration\nconst config: Phaser.Types.Core.GameConfig = {\n  type: AUTO,\n  parent: \"game-container\",\n  backgroundColor: \"#2c3e50\",\n  physics: {\n    default: \"arcade\",\n    arcade: {\n      gravity: { x: 0, y: 600 },\n      debug: false,\n    },\n  },\n  scale: {\n    mode: Phaser.Scale.RESIZE,\n    autoCenter: Phaser.Scale.CENTER_BOTH,\n    width: 1024,\n    height: 768,\n  },\n  scene: [Boot, Preloader, MainMenu, MuseRunnerGame, GameOver],\n};\n\nconst StartGame = (parent: string) => {\n  return new Game({ ...config, parent });\n};\n\nexport default StartGame;\n","import StartGame from \"./game/main\";\n\ndocument.addEventListener(\"DOMContentLoaded\", () => {\n  StartGame(\"game-container\");\n});\n"],"names":["Boot","Scene","constructor","super","preload","this","load","image","create","scene","start","GameOver","__publicField","camera","cameras","main","setBackgroundColor","background","add","setOrigin","setAlpha","gameover_text","text","fontFamily","fontSize","color","stroke","strokeThickness","align","updateLayout","scale","width","height","on","gameSize","input","once","resize","setDisplaySize","scaleFactor","Math","min","setPosition","setScale","GAME_CONSTANTS","CHARACTER","SPEED","WIDTH","HEIGHT","COLOR","VISUAL_FEEDBACK_COLOR","VISUAL_FEEDBACK_DURATION","PLATFORMS","EXTENSION_DISTANCE","AHEAD_OFFSET","CENTER_OFFSET","CLEANUP_DISTANCE","AUDIO","NOTE_DURATION","ATTACK_TIME","VOLUME","GAME","OVER_FALL_DISTANCE","SCORE_PER_PLATFORM","GROUND_OFFSET","CHARACTER_HEIGHT_LERP_SPEED","FALL_VELOCITY","LEVEL_HEIGHTS","S","D","F","G","H","J","K","LEVEL_COLORS","VALID_KEYS","NOTE_FREQUENCIES","AudioManager","initialize","audioContext","window","AudioContext","webkitAudioContext","audioAvailable","isInitialized","console","log","error","warn","playNote","key","frequency","playMusicalTone","isAudioAvailable","oscillator","createOscillator","gainNode","createGain","connect","destination","setValueAtTime","currentTime","type","gain","linearRampToValueAtTime","exponentialRampToValueAtTime","stop","InputManager","Set","keyboard","update","_currentTime","previouslyPressedKeys","currentlyPressedKeys","clear","forEach","addKey","isDown","keyStateChanged","hasKeyStateChanged","getInputState","pressedKeys","size","has","isValidGameKey","includes","PlatformManager","Map","platformsGroup","group","startNewPlatform","startX","activePlatforms","platformY","platformColor","platform","rectangle","physics","existing","platformData","set","endPlatform","get","delete","extendActivePlatforms","characterX","_key","targetRightEdge","x","newWidth","newCenterX","setSize","y","getHighestActiveKey","highestKey","highestY","Number","POSITIVE_INFINITY","_platformData","levelHeight","hasActivePlatforms","cleanupOldPlatforms","platformsToRemove","children","entries","rect","push","remove","destroy","length","getActivePlatforms","getPlatformsGroup","getLevelHeight","getLevelColor","MuseRunnerGame","audioManager","inputManager","platformManager","character","characterBody","body","setCollideWorldBounds","setDragX","setFrictionX","setGravityY","scoreText","instructionText","tweens","targets","alpha","duration","yoyo","repeat","restart","isGameRunning","startFollow","setDeadzone","score","setVelocityX","time","now","inputState","handleKeyChanges","updateCharacterHeight","floor","gameOver","setFillStyle","delayedCall","setText","targetY","currentY","heightDiff","abs","newY","Phaser.Math","Linear","setVelocityY","groundY","stopFollow","scrollX","scrollY","setScrollFactor","restartText","parent","postMessage","data","finalScore","MainMenu","init","title","subtitle","instructions","startText","credits","refreshLayout","Preloader","setStrokeStyle","bar","progress","setPath","config","AUTO","backgroundColor","default","arcade","gravity","debug","mode","Phaser.Scale","RESIZE","autoCenter","CENTER_BOTH","document","addEventListener","Game"],"mappings":"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"}