var t=Object.defineProperty,e=(e,s,i)=>((e,s,i)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i)(e,"symbol"!=typeof s?s+"":s,i);import{r as s}from"./phaser-CRaLQf_f.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const s of t)if("childList"===s.type)for(const t of s.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();var i=s();class o extends i.Scene{constructor(){super("Boot")}preload(){}create(){this.scene.start("Preloader")}}class a extends i.Scene{constructor(){super("GameOver"),e(this,"camera"),e(this,"background"),e(this,"gameOverText")}create(){this.camera=this.cameras.main,this.camera.setBackgroundColor(16711680),this.background=this.add.image(0,0,"background").setOrigin(0).setAlpha(.5),this.gameOverText=this.add.text(0,0,"Game Over",{fontFamily:"Arial Black",fontSize:"64px",color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.updateLayout(this.scale.width,this.scale.height),this.scale.on("resize",(t=>{const{width:e,height:s}=t;this.updateLayout(e,s)})),this.input.once("pointerdown",(()=>{this.scene.start("MainMenu")}))}updateLayout(t,e){this.cameras.resize(t,e),this.background&&this.background.setDisplaySize(t,e);const s=Math.min(Math.min(t/1024,e/768),1);this.gameOverText&&(this.gameOverText.setPosition(t/2,e/2),this.gameOverText.setScale(s))}}const r={CHARACTER:{SPEED:100,WIDTH:30,HEIGHT:40,COLOR:3447003,VISUAL_FEEDBACK_COLOR:15965202,VISUAL_FEEDBACK_DURATION:200},PLATFORMS:{WIDTH:120,HEIGHT:20,EXTENSION_DISTANCE:150,AHEAD_OFFSET:20,CLEANUP_DISTANCE:400,MIN_LENGTH:20,GROWTH_RATE:100},AUDIO:{NOTE_DURATION:.5,ATTACK_TIME:.01,VOLUME:.3},GAME:{OVER_FALL_DISTANCE:300,SCORE_PER_PLATFORM:10,GROUND_OFFSET:60,CHARACTER_HEIGHT_LERP_SPEED:.08,FALL_VELOCITY:300,CAMERA_DEADZONE_X:200,CAMERA_DEADZONE_Y:100,CAMERA_FOLLOW_LERP_X:.1,CAMERA_FOLLOW_LERP_Y:.1,GROUND_GRACE_PERIOD:1e3,SCORE_DECAY_RATE:1,SCREEN_SHAKE_INTENSITY:2,C2_FREQUENCY:65.41,DISSONANCE_START_TIME:2e3},CHORD_DETECTION:{ACCUMULATION_TIME:1e3,TRIAD_POINTS:50,SEVENTH_POINTS:100,POWER_CHORD_POINTS:25},LEVEL_HEIGHTS:{S:-80,R:-100,D:-120,F:-160,G:-200,H:-240,J:-280,K:-320,U:-260,I:-300,A:-40,L:-360,";":-400,"'":-440},LEVEL_COLORS:{S:15158332,D:15965202,F:15844367,G:3066993,H:3447003,J:10181046,K:15277667,R:16739179,U:5164484,I:4569041,A:9323693,L:15105570,";":1482885,"'":2600544},VALID_KEYS:["S","D","F","G","H","J","K","R","U","I","A","L",";","'","0","1","2","3","4","5","6","7","8"],ERROR_HANDLING:{MANAGER_INIT_FAILED:"Failed to initialize managers",INPUT_HANDLING_ERROR:"Input handling error",PLATFORM_EXTENSION_ERROR:"Platform extension error",CHARACTER_HEIGHT_ERROR:"Character height update error",PLATFORM_CLEANUP_ERROR:"Platform cleanup error",KEY_CHANGE_ERROR:"Key change handling error",PLATFORM_START_ERROR:"Failed to start platform",PLATFORM_END_ERROR:"Failed to end platform"}},n={S:261.63,D:293.66,F:329.63,G:349.23,H:392,J:440,K:493.88,R:311.13,U:415.3,I:466.16,A:246.94,L:523.25,";":587.33,"'":659.25};class h{constructor(){e(this,"audioContext",null),e(this,"isInitialized",!1),e(this,"audioAvailable",!1),e(this,"lfoRate",2),e(this,"chorusDepth",.1),e(this,"delayTime",.25),e(this,"delayVolume",.3),e(this,"reverbAmount",.3),e(this,"distortionAmount",.2),e(this,"currentWaveform","sawtooth"),e(this,"activeNotes",new Map),e(this,"groundC2Oscillators",[]),e(this,"groundC2Gain",null),e(this,"dissonanceOscillator",null),e(this,"dissonanceGain",null)}initialize(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.audioAvailable=!0,this.isInitialized=!0}catch(t){console.warn("Web Audio API not available:",t),this.audioAvailable=!1,this.isInitialized=!0}}playNote(t){if(!this.isInitialized)return void console.warn("AudioManager not initialized");if(!this.audioAvailable||!this.audioContext)return;const e=n[t];if(e){if(!this.activeNotes.has(t))try{this.startSustainedNote(t,e)}catch(s){console.warn("Failed to play note:",s)}}else console.warn(`Unknown key: ${t}`)}stopNote(t){const e=this.activeNotes.get(t);if(e){const s=this.audioContext.currentTime;e.gainNode.gain.exponentialRampToValueAtTime(.001,s+.1),setTimeout((()=>{e.oscillators.forEach((t=>{try{t.stop(),t.disconnect()}catch(e){}})),e.gainNode.disconnect(),this.activeNotes.delete(t)}),100)}}isAudioAvailable(){return this.audioAvailable}updateLFORate(t){this.lfoRate=Math.max(.1,Math.min(10,this.lfoRate+t)),console.log(`LFO Rate: ${this.lfoRate.toFixed(1)} Hz`)}updateChorusDepth(t){this.chorusDepth=Math.max(0,Math.min(1,this.chorusDepth+t)),console.log(`Chorus Depth: ${(100*this.chorusDepth).toFixed(0)}%`)}updateDelayVolume(t){this.delayVolume=Math.max(0,Math.min(1,this.delayVolume+t)),console.log(`Delay Volume: ${(100*this.delayVolume).toFixed(0)}%`)}updateReverbAmount(t){this.reverbAmount=Math.max(0,Math.min(1,this.reverbAmount+t)),console.log(`Reverb Amount: ${(100*this.reverbAmount).toFixed(0)}%`)}switchWaveform(){const t=["sawtooth","square","triangle","sine"],e=(t.indexOf(this.currentWaveform)+1)%t.length;this.currentWaveform=t[e],console.log(`🎵 Waveform switched to: ${this.currentWaveform}`)}getLFORate(){return this.lfoRate}getChorusDepth(){return this.chorusDepth}getDelayVolume(){return this.delayVolume}getReverbAmount(){return this.reverbAmount}getDistortionAmount(){return this.distortionAmount}getCurrentWaveform(){return this.currentWaveform}startSustainedNote(t,e){if(!this.audioContext)return;const s=this.audioContext.createOscillator(),i=this.audioContext.createOscillator(),o=this.audioContext.createGain();i.frequency.setValueAtTime(this.lfoRate,this.audioContext.currentTime),i.type="sine",o.gain.setValueAtTime(2,this.audioContext.currentTime),i.connect(o),o.connect(s.frequency),s.frequency.setValueAtTime(e,this.audioContext.currentTime),s.type=this.currentWaveform;const a=this.audioContext.createOscillator(),n=this.audioContext.createOscillator(),h=this.audioContext.createGain(),l=this.audioContext.createGain(),c=10*this.chorusDepth;a.frequency.setValueAtTime(e+c,this.audioContext.currentTime),n.frequency.setValueAtTime(e-c,this.audioContext.currentTime),a.type=this.currentWaveform,n.type=this.currentWaveform,h.gain.setValueAtTime(.2,this.audioContext.currentTime),l.gain.setValueAtTime(.2,this.audioContext.currentTime);const d=this.audioContext.createDelay(),u=this.audioContext.createGain(),m=this.audioContext.createGain();d.delayTime.setValueAtTime(this.delayTime,this.audioContext.currentTime),u.gain.setValueAtTime(this.delayVolume,this.audioContext.currentTime),m.gain.setValueAtTime(.2,this.audioContext.currentTime);const y=this.audioContext.createWaveShaper(),f=this.createDistortionCurve(.5*this.distortionAmount);y.curve=f,y.oversample="2x";const p=this.audioContext.createGain();s.connect(p),a.connect(h).connect(p),n.connect(l).connect(p);const g=this.audioContext.createGain(),C=this.audioContext.createGain();g.gain.setValueAtTime(1-this.delayVolume,this.audioContext.currentTime),C.gain.setValueAtTime(this.delayVolume,this.audioContext.currentTime),p.connect(g),p.connect(C),C.connect(d),d.connect(u),d.connect(m),m.connect(d),u.connect(y);const T=this.audioContext.createGain();g.connect(T),y.connect(T),T.connect(this.audioContext.destination);const b=this.audioContext.currentTime;p.gain.setValueAtTime(0,b),p.gain.linearRampToValueAtTime(.5*r.AUDIO.VOLUME,b+.01),s.start(b),i.start(b),a.start(b),n.start(b),this.activeNotes.set(t,{oscillators:[s,i,a,n],gainNode:p,isSustaining:!0})}playMusicalTone(t){if(!this.audioContext)return;const e=this.audioContext.createOscillator(),s=this.audioContext.createOscillator(),i=this.audioContext.createGain();s.frequency.setValueAtTime(this.lfoRate,this.audioContext.currentTime),s.type="sine",i.gain.setValueAtTime(5,this.audioContext.currentTime),s.connect(i),i.connect(e.frequency),e.frequency.setValueAtTime(t,this.audioContext.currentTime),e.type="sawtooth";const o=this.audioContext.createOscillator(),a=this.audioContext.createOscillator(),n=this.audioContext.createGain(),h=this.audioContext.createGain(),l=20*this.chorusDepth;o.frequency.setValueAtTime(t+l,this.audioContext.currentTime),a.frequency.setValueAtTime(t-l,this.audioContext.currentTime),o.type="sawtooth",a.type="sawtooth",n.gain.setValueAtTime(.3,this.audioContext.currentTime),h.gain.setValueAtTime(.3,this.audioContext.currentTime);const c=this.audioContext.createBiquadFilter();c.type="lowpass",c.frequency.setValueAtTime(this.filterFrequency,this.audioContext.currentTime),c.Q.setValueAtTime(1,this.audioContext.currentTime);const d=this.audioContext.createWaveShaper(),u=this.createDistortionCurve(this.distortionAmount);d.curve=u,d.oversample="4x";const m=this.audioContext.createDelay(),y=this.audioContext.createGain(),f=this.audioContext.createGain();m.delayTime.setValueAtTime(.1,this.audioContext.currentTime),y.gain.setValueAtTime(.3*this.reverbAmount,this.audioContext.currentTime),f.gain.setValueAtTime(.1,this.audioContext.currentTime);const p=this.audioContext.createGain();e.connect(p),o.connect(n).connect(p),a.connect(h).connect(p),p.connect(c),c.connect(d);const g=this.audioContext.createGain(),C=this.audioContext.createGain();g.gain.setValueAtTime(1-this.reverbAmount,this.audioContext.currentTime),C.gain.setValueAtTime(this.reverbAmount,this.audioContext.currentTime),d.connect(g),d.connect(C),C.connect(m),m.connect(f),f.connect(m),m.connect(T);const T=this.audioContext.createGain();g.connect(T),C.connect(T),T.connect(this.audioContext.destination);const b=this.audioContext.currentTime,A=r.AUDIO.NOTE_DURATION;T.gain.setValueAtTime(0,b),T.gain.linearRampToValueAtTime(r.AUDIO.VOLUME,b+.01),T.gain.linearRampToValueAtTime(.7*r.AUDIO.VOLUME,b+.01+.1),T.gain.exponentialRampToValueAtTime(.001,b+A),e.start(b),s.start(b),o.start(b),a.start(b);const E=b+A;e.stop(E),s.stop(E),o.stop(E),a.stop(E)}createDistortionCurve(t){const e=44100,s=new Float32Array(e),i=Math.PI/180;for(let o=0;o<e;o++){const a=2*o/e-1;s[o]=(3+t)*a*20*i/(Math.PI+t*Math.abs(a))}return s}playGroundC2(){if(!this.audioContext||this.groundC2Oscillators.length>0)return;this.groundC2Gain=this.audioContext.createGain();const t=this.audioContext.currentTime,e=this.audioContext.createOscillator();e.frequency.setValueAtTime(r.GAME.C2_FREQUENCY,t),e.type="sine";const s=this.audioContext.createOscillator();s.frequency.setValueAtTime(2*r.GAME.C2_FREQUENCY,t),s.type="sawtooth";const i=this.audioContext.createOscillator();i.frequency.setValueAtTime(1.5*r.GAME.C2_FREQUENCY,t),i.type="triangle";const o=this.audioContext.createOscillator();o.frequency.setValueAtTime(.5*r.GAME.C2_FREQUENCY,t),o.type="sine";const a=this.audioContext.createGain(),n=this.audioContext.createGain(),h=this.audioContext.createGain(),l=this.audioContext.createGain();a.gain.setValueAtTime(.4,t),n.gain.setValueAtTime(.2,t),h.gain.setValueAtTime(.3,t),l.gain.setValueAtTime(.3,t),e.connect(a),s.connect(n),i.connect(h),o.connect(l),a.connect(this.groundC2Gain),n.connect(this.groundC2Gain),h.connect(this.groundC2Gain),l.connect(this.groundC2Gain),this.groundC2Gain.connect(this.audioContext.destination),this.groundC2Gain.gain.setValueAtTime(0,t),this.groundC2Gain.gain.linearRampToValueAtTime(.4*r.AUDIO.VOLUME,t+.8),e.start(t),s.start(t),i.start(t),o.start(t),this.groundC2Oscillators=[e,s,i,o]}stopGroundC2(){if(this.groundC2Oscillators.length>0&&this.groundC2Gain){const t=this.audioContext.currentTime;this.groundC2Gain.gain.exponentialRampToValueAtTime(.001,t+.3),setTimeout((()=>{try{this.groundC2Oscillators.forEach((t=>{t.stop(),t.disconnect()})),this.groundC2Gain.disconnect()}catch(t){}this.groundC2Oscillators=[],this.groundC2Gain=null}),300)}}playDissonance(t){if(!this.audioContext||this.dissonanceOscillator)return;this.dissonanceOscillator=this.audioContext.createOscillator(),this.dissonanceGain=this.audioContext.createGain();const e=r.GAME.C2_FREQUENCY*Math.pow(2,.5);this.dissonanceOscillator.frequency.setValueAtTime(e,this.audioContext.currentTime),this.dissonanceOscillator.type="sawtooth",this.dissonanceOscillator.connect(this.dissonanceGain),this.dissonanceGain.connect(this.audioContext.destination);const s=this.audioContext.currentTime;this.dissonanceGain.gain.setValueAtTime(0,s),this.dissonanceGain.gain.linearRampToValueAtTime(t*r.AUDIO.VOLUME*.2,s+.3),this.dissonanceOscillator.start(s)}stopDissonance(){if(this.dissonanceOscillator&&this.dissonanceGain){const t=this.audioContext.currentTime;this.dissonanceGain.gain.exponentialRampToValueAtTime(.001,t+.3),setTimeout((()=>{try{this.dissonanceOscillator.stop(),this.dissonanceOscillator.disconnect(),this.dissonanceGain.disconnect()}catch(t){}this.dissonanceOscillator=null,this.dissonanceGain=null}),300)}}}class l{constructor(t){e(this,"scene"),e(this,"currentlyPressedKeys",new Set),e(this,"previouslyPressedKeys",new Set),e(this,"isInitialized",!1),e(this,"keyObjects",new Map),e(this,"arrowKeys",{up:null,down:null,left:null,right:null}),this.scene=t}initialize(){this.scene.input.keyboard?(r.VALID_KEYS.forEach((t=>{";"===t?this.keyObjects.set(t,this.scene.input.keyboard.addKey(i.Input.Keyboard.KeyCodes.SEMICOLON)):"'"===t?this.keyObjects.set(t,this.scene.input.keyboard.addKey(i.Input.Keyboard.KeyCodes.QUOTES)):this.keyObjects.set(t,this.scene.input.keyboard.addKey(t))})),this.arrowKeys.up=this.scene.input.keyboard.addKey(i.Input.Keyboard.KeyCodes.UP),this.arrowKeys.down=this.scene.input.keyboard.addKey(i.Input.Keyboard.KeyCodes.DOWN),this.arrowKeys.left=this.scene.input.keyboard.addKey(i.Input.Keyboard.KeyCodes.LEFT),this.arrowKeys.right=this.scene.input.keyboard.addKey(i.Input.Keyboard.KeyCodes.RIGHT),this.keyObjects.set("1",this.scene.input.keyboard.addKey(i.Input.Keyboard.KeyCodes.ONE)),this.keyObjects.set("2",this.scene.input.keyboard.addKey(i.Input.Keyboard.KeyCodes.TWO)),this.keyObjects.set("3",this.scene.input.keyboard.addKey(i.Input.Keyboard.KeyCodes.THREE)),this.keyObjects.set("4",this.scene.input.keyboard.addKey(i.Input.Keyboard.KeyCodes.FOUR)),this.keyObjects.set("5",this.scene.input.keyboard.addKey(i.Input.Keyboard.KeyCodes.FIVE)),this.keyObjects.set("6",this.scene.input.keyboard.addKey(i.Input.Keyboard.KeyCodes.SIX)),this.keyObjects.set("7",this.scene.input.keyboard.addKey(i.Input.Keyboard.KeyCodes.SEVEN)),this.keyObjects.set("8",this.scene.input.keyboard.addKey(i.Input.Keyboard.KeyCodes.EIGHT)),this.keyObjects.set("0",this.scene.input.keyboard.addKey(i.Input.Keyboard.KeyCodes.ZERO)),this.isInitialized=!0):console.warn("Keyboard input not available")}update(t){return this.isInitialized&&this.scene.input.keyboard?(this.previouslyPressedKeys=new Set(this.currentlyPressedKeys),this.currentlyPressedKeys.clear(),r.VALID_KEYS.forEach((t=>{const e=this.keyObjects.get(t);e&&e.isDown&&this.currentlyPressedKeys.add(t)})),["1","2","3","4","5","6","7","8","0"].forEach((t=>{const e=this.keyObjects.get(t);e&&e.isDown&&this.currentlyPressedKeys.add(t)})),{keyStateChanged:this.hasKeyStateChanged()}):{keyStateChanged:!1}}getInputState(){return{pressedKeys:new Set(this.currentlyPressedKeys)}}getArrowKeyState(){var t,e,s,i;return{up:(null==(t=this.arrowKeys.up)?void 0:t.isDown)||!1,down:(null==(e=this.arrowKeys.down)?void 0:e.isDown)||!1,left:(null==(s=this.arrowKeys.left)?void 0:s.isDown)||!1,right:(null==(i=this.arrowKeys.right)?void 0:i.isDown)||!1}}hasKeyStateChanged(){if(this.currentlyPressedKeys.size!==this.previouslyPressedKeys.size)return!0;for(const t of this.currentlyPressedKeys)if(!this.previouslyPressedKeys.has(t))return!0;for(const t of this.previouslyPressedKeys)if(!this.currentlyPressedKeys.has(t))return!0;return!1}isValidGameKey(t){return r.VALID_KEYS.includes(t)}}class c{constructor(t){e(this,"scene"),e(this,"activePlatforms",new Map),e(this,"platformsGroup"),e(this,"isInitialized",!1),this.scene=t,this.platformsGroup=this.scene.add.group()}initialize(){this.isInitialized=!0}startNewPlatform(t,e){if(!this.isInitialized)return void console.warn("PlatformManager not initialized");if(this.activePlatforms.has(t))return;const{height:s}=this.scene.cameras.main,i=s+r.LEVEL_HEIGHTS[t],o=r.LEVEL_COLORS[t],a=this.scene.add.rectangle(e+r.PLATFORMS.AHEAD_OFFSET,i,r.PLATFORMS.MIN_LENGTH+20,r.PLATFORMS.HEIGHT+10,o,.3);a.setStrokeStyle(3,o,.6);const n=this.scene.add.rectangle(e+r.PLATFORMS.AHEAD_OFFSET,i,r.PLATFORMS.MIN_LENGTH,r.PLATFORMS.HEIGHT,o),h=this.scene.add.rectangle(e+r.PLATFORMS.AHEAD_OFFSET,i-2,r.PLATFORMS.MIN_LENGTH,r.PLATFORMS.HEIGHT/2,16777215,.2),l=this.scene.add.text(e+r.PLATFORMS.AHEAD_OFFSET,i,this.getNoteSymbol(t),{fontSize:"16px",color:"#FFFFFF",fontFamily:"Nabla, system-ui",stroke:"#000000",strokeThickness:2});l.setOrigin(.5),this.scene.physics.add.existing(n,!0);const c=this.scene.tweens.add({targets:[n,a,h],scaleX:1.05,scaleY:1.05,duration:1e3,yoyo:!0,repeat:-1,ease:"Sine.easeInOut"}),d={rectangle:n,startX:e,key:t,startTime:this.scene.time.now,isGrowing:!0,glowEffect:a,noteSymbol:l,pulseTween:c};this.activePlatforms.set(t,d),this.platformsGroup.add(n),this.platformsGroup.add(a),this.platformsGroup.add(h),this.platformsGroup.add(l)}getNoteSymbol(t){return{S:"♪",D:"♫",F:"♪",G:"♫",H:"♪",J:"♫",K:"♪",R:"♯",U:"♯",I:"♭",A:"♪",L:"♫",";":"♪","'":"♫"}[t]||"♪"}endPlatform(t){const e=this.activePlatforms.get(t);e&&(e.pulseTween&&e.pulseTween.stop(),this.scene.tweens.add({targets:[e.rectangle,e.glowEffect,e.noteSymbol],alpha:.3,duration:500,ease:"Power2"}),e.isGrowing=!1,this.activePlatforms.delete(t))}extendActivePlatforms(t){this.activePlatforms.forEach(((e,s)=>{if(!e.isGrowing)return;const i=e.rectangle,o=t-e.startX,a=Math.max(r.PLATFORMS.MIN_LENGTH,r.PLATFORMS.MIN_LENGTH+o),n=i.x-i.width/2+a/2;i.setSize(a,i.height),i.setPosition(n,i.y)}))}getHighestActiveKey(){if(0===this.activePlatforms.size)return null;let t=null,e=Number.POSITIVE_INFINITY;return this.activePlatforms.forEach(((s,i)=>{const o=r.LEVEL_HEIGHTS[i];o<e&&(e=o,t=i)})),t}hasActivePlatforms(){return this.activePlatforms.size>0}cleanupOldPlatforms(t){const e=[];this.platformsGroup.children.entries.forEach((s=>{const i=s;i.x+i.width/2<t-r.PLATFORMS.CLEANUP_DISTANCE&&e.push(i)})),e.forEach((t=>{this.platformsGroup.remove(t),t.destroy()}))}getActivePlatforms(){return new Map(this.activePlatforms)}getPlatformsGroup(){return this.platformsGroup}getLevelHeight(t){return r.LEVEL_HEIGHTS[t]}getLevelColor(t){return r.LEVEL_COLORS[t]}}const d={S:"C",D:"D",F:"E",G:"F",H:"G",J:"A",K:"B",R:"D#",U:"G#",I:"Bb",A:"B",L:"C",";":"D","'":"E"},u={"C,E,G":{name:"C Major (I)",points:50},"A,D,F":{name:"D Minor (ii)",points:50},"B,E,G":{name:"E Minor (iii)",points:50},"A,C,F":{name:"F Major (IV)",points:50},"B,D,G":{name:"G Major (V)",points:50},"A,C,E":{name:"A Minor (vi)",points:50},"B,D,F":{name:"B Diminished (vii°)",points:50},"B,C,E,G":{name:"C Major 7 (IΔ7)",points:100},"A,C,D,F":{name:"D Minor 7 (ii7)",points:100},"B,D,E,G":{name:"E Minor 7 (iii7)",points:100},"A,C,E,F":{name:"F Major 7 (IVΔ7)",points:100},"B,D,F,G":{name:"G Dominant 7 (V7)",points:100},"A,C,E,G":{name:"A Minor 7 (vi7)",points:100},"A,B,D,F":{name:"B Half-Diminished 7 (viiø7)",points:100},"B,C,D,E,G":{name:"C Major 9",points:150},"A,C,D,E,F":{name:"D Minor 9",points:150},"A,B,D,F,G":{name:"G9 (Dominant 9)",points:150},"A,B,C,E,G":{name:"A Minor 9",points:150},"C,F,G":{name:"Csus4",points:50},"C,D,G":{name:"Csus2",points:50},"A,D,G":{name:"Dsus4",points:50},"C,D,E,G":{name:"Cadd9",points:75},"C,G":{name:"C5",points:25},"A,D":{name:"D5",points:25},"B,E":{name:"E5",points:25},"C,F":{name:"F5",points:25},"D,G":{name:"G5",points:25},"A,E":{name:"A5",points:25},"B,F":{name:"B5",points:25}},m={"A,C,D#":{name:"A Diminished (viio/iii)",points:50},"A,C#,E":{name:"A Major (V/ii)",points:50},"A,D,F#":{name:"D Major (V/V)",points:50},"A#,C#,E":{name:"A# Diminished (viio/bII)",points:50},"A#,C,D,F":{name:"F Minor (iv)",points:50},"A#,F,G#":{name:"F Augmented (IV+)",points:50},"A#,D,F":{name:"Bb Major (bVII)",points:50},"A#,D,G":{name:"G Minor (v)",points:50},"A#,D,G#":{name:"Ab Major (bVI)",points:50},"B,D#,G#":{name:"G# Minor (iii/vi)",points:50},"C,D#,G":{name:"C Minor (i)",points:50},"A#,C,D#,G":{name:"C Minor 7 (i7)",points:100},"C,E,G#":{name:"C Augmented (I+)",points:50},"B,C,E,G#":{name:"C Augmented Major 7 (I+Δ7)",points:100},"C#,E,G#":{name:"C# Diminished (viio/ii)",points:50},"C#,F,G#":{name:"C# Minor (ii/ii)",points:50},"B,C#,F,G#":{name:"C# Minor 7 (ii7/ii)",points:100},"D,F,G#":{name:"D Augmented (II+)",points:50},"A#,D#,G":{name:"Eb Minor (biii)",points:50},"B,D#,G":{name:"D# Diminished",points:50},"B,E,G#":{name:"E Major (III)",points:50},"B,D,E,G#":{name:"E Dominant 7 (V7/vi)",points:100},"C,F,G#":{name:"F Augmented (IV+)",points:50},"A#,C,F":{name:"F Minor (iv)",points:50},"A#,C,F,G#":{name:"F Augmented (IV+)",points:50},"A#,F":{name:"Bb5 (bVII5)",points:25},"A#,D#":{name:"Eb5 (bIII5)",points:25},"D#,G#":{name:"Ab5 (bVI5)",points:25}};function y(t){return t.map((t=>d[t]||t))}class f{constructor(t){e(this,"scene"),e(this,"currentChord",null),this.scene=t}update(t){const e=Array.from(t).sort(),s=y(e),i=s.join(",");t.size>1&&(console.log("Keys pressed:",e.join(",")),console.log("Notes:",s.join(",")),console.log("Looking for chord:",i));const o=(a=e,function(t){const e=[...t].sort().join(",");console.log("Looking for chord:",e),console.log("Available main chords:",Object.keys(u).length),console.log("Available extended chords:",Object.keys(m).length);const s=u[e];if(s)return console.log("✅ Found in main chords:",s.name),s;const i=m[e];return i?(console.log("✅ Found in extended chords:",i.name),i):(console.log("❌ No chord found for:",e),null)}(y([...a].sort())));var a;if(o){console.log("✅ Chord detected:",o.name),this.currentChord&&this.currentChord.chordType===o.name||(this.currentChord={chordType:o.name,basePoints:o.points,accumulatedPoints:0,startTime:this.scene.time.now,isComplete:!1});const t=this.scene.time.now-this.currentChord.startTime,e=Math.min(t/r.CHORD_DETECTION.ACCUMULATION_TIME,1),s=Math.floor(this.currentChord.basePoints*e),i=s-this.currentChord.accumulatedPoints;return this.currentChord.accumulatedPoints=s,e>=1&&!this.currentChord.isComplete&&(this.currentChord.isComplete=!0),{points:i,chordName:this.currentChord.chordType}}return t.size>1&&console.log("❌ No chord found for:",i),this.currentChord=null,{points:0,chordName:null}}getCurrentChord(){return this.currentChord}}class p{constructor(t,s,i){e(this,"scene"),e(this,"audioManager"),e(this,"config"),e(this,"screenSize"),e(this,"panelBackground"),e(this,"titleText"),e(this,"lfoKnob"),e(this,"lfoLabel"),e(this,"lfoValue"),e(this,"lfoPointer"),e(this,"chorusKnob"),e(this,"chorusLabel"),e(this,"chorusValue"),e(this,"chorusPointer"),e(this,"delaySlider"),e(this,"delayTrack"),e(this,"delayHandle"),e(this,"delayLabel"),e(this,"delayValue"),e(this,"delayLEDs"),e(this,"reverbKnob"),e(this,"reverbLabel"),e(this,"reverbValue"),e(this,"reverbPointer"),e(this,"waveformSelector"),e(this,"waveformLabel"),e(this,"waveformValue"),e(this,"waveformIcons"),e(this,"animationTweens",[]),this.scene=t,this.audioManager=s,this.config=i,this.screenSize=this.calculateScreenSize()}create(){this.updateScreenSize(),this.createPanelBackground(),this.createTitle(),this.createLFOControl(),this.createChorusControl(),this.createDelayControl(),this.createReverbControl(),this.createWaveformSelector()}createPanelBackground(){const{x:t,y:e,width:s,height:i}=this.config;this.panelBackground=this.scene.add.graphics(),this.panelBackground.setScrollFactor(0),this.panelBackground.setDepth(100),this.panelBackground.fillStyle(2899536,.95),this.panelBackground.fillRoundedRect(t,e,s,i,8),this.panelBackground.lineStyle(2,8359053,1),this.panelBackground.strokeRoundedRect(t,e,s,i,8),this.panelBackground.lineStyle(1,9807270,.5),this.panelBackground.strokeRoundedRect(t+1,e+1,s-2,i-2,6)}createTitle(){const{x:t,y:e,width:s}=this.config;this.titleText=this.scene.add.text(t+s/2,e+15,"🎛️ SYNTH CONTROLS",{fontSize:"16px",color:"#ecf0f1",fontFamily:"Nabla, system-ui",stroke:"#000000",strokeThickness:2,shadow:{offsetX:1,offsetY:1,color:"#000000",blur:2,fill:!0}}),this.titleText.setOrigin(.5,.5),this.titleText.setScrollFactor(0),this.titleText.setDepth(101)}createLFOControl(){const{x:t,y:e}=this.config,s=t+60,i=e+45;this.lfoKnob=this.scene.add.graphics(),this.lfoKnob.setScrollFactor(0),this.lfoKnob.setDepth(101),this.lfoKnob.fillStyle(15965202,.8),this.lfoKnob.fillCircle(s,i,20),this.lfoKnob.lineStyle(2,15105570,1),this.lfoKnob.strokeCircle(s,i,20),this.lfoKnob.fillStyle(2899536,1),this.lfoKnob.fillCircle(s,i,8),this.lfoPointer=this.scene.add.graphics(),this.lfoPointer.setScrollFactor(0),this.lfoPointer.setDepth(102),this.lfoLabel=this.scene.add.text(s,i+35,"LFO",{fontSize:"12px",color:"#f39c12",fontFamily:"Nabla, system-ui",stroke:"#000000",strokeThickness:1,shadow:{offsetX:1,offsetY:1,color:"#000000",blur:1,fill:!0}}),this.lfoLabel.setOrigin(.5,.5),this.lfoLabel.setScrollFactor(0),this.lfoLabel.setDepth(101),this.lfoValue=this.scene.add.text(s,i+50,"2.0Hz",{fontSize:"10px",color:"#ffffff",fontFamily:"Nabla, system-ui",stroke:"#000000",strokeThickness:1,shadow:{offsetX:1,offsetY:1,color:"#000000",blur:1,fill:!0}}),this.lfoValue.setOrigin(.5,.5),this.lfoValue.setScrollFactor(0),this.lfoValue.setDepth(101)}createChorusControl(){const{x:t,y:e}=this.config,s=t+140,i=e+45;this.chorusKnob=this.scene.add.graphics(),this.chorusKnob.setScrollFactor(0),this.chorusKnob.setDepth(101),this.chorusKnob.fillStyle(3447003,.8),this.chorusKnob.fillCircle(s,i,20),this.chorusKnob.lineStyle(2,2719929,1),this.chorusKnob.strokeCircle(s,i,20),this.chorusKnob.fillStyle(2899536,1),this.chorusKnob.fillCircle(s,i,8),this.chorusPointer=this.scene.add.graphics(),this.chorusPointer.setScrollFactor(0),this.chorusPointer.setDepth(102),this.chorusLabel=this.scene.add.text(s,i+35,"CHORUS",{fontSize:"10px",color:"#3498db",fontFamily:"Nabla, system-ui",stroke:"#000000",strokeThickness:1}),this.chorusLabel.setOrigin(.5,.5),this.chorusLabel.setScrollFactor(0),this.chorusLabel.setDepth(101),this.chorusValue=this.scene.add.text(s,i+50,"10%",{fontSize:"8px",color:"#ffffff",fontFamily:"Nabla, system-ui",stroke:"#000000",strokeThickness:1}),this.chorusValue.setOrigin(.5,.5),this.chorusValue.setScrollFactor(0),this.chorusValue.setDepth(101)}createDelayControl(){const{x:t,y:e}=this.config,s=t+220,i=e+35;this.delayTrack=this.scene.add.graphics(),this.delayTrack.setScrollFactor(0),this.delayTrack.setDepth(101),this.delayTrack.fillStyle(3426654,1),this.delayTrack.fillRoundedRect(s-3,i,6,50,3),this.delayTrack.lineStyle(1,2899536,1),this.delayTrack.strokeRoundedRect(s-3,i,6,50,3),this.delayLEDs=this.scene.add.graphics(),this.delayLEDs.setScrollFactor(0),this.delayLEDs.setDepth(101),this.delayHandle=this.scene.add.graphics(),this.delayHandle.setScrollFactor(0),this.delayHandle.setDepth(102),this.delayLabel=this.scene.add.text(s,i+60,"DELAY",{fontSize:"10px",color:"#2ecc71",fontFamily:"Nabla, system-ui",stroke:"#000000",strokeThickness:1}),this.delayLabel.setOrigin(.5,.5),this.delayLabel.setScrollFactor(0),this.delayLabel.setDepth(101),this.delayValue=this.scene.add.text(s,i+75,"30%",{fontSize:"8px",color:"#ffffff",fontFamily:"Nabla, system-ui",stroke:"#000000",strokeThickness:1}),this.delayValue.setOrigin(.5,.5),this.delayValue.setScrollFactor(0),this.delayValue.setDepth(101)}createReverbControl(){const{x:t,y:e}=this.config,s=t+300,i=e+45;this.reverbKnob=this.scene.add.graphics(),this.reverbKnob.setScrollFactor(0),this.reverbKnob.setDepth(101),this.reverbKnob.fillStyle(10181046,.8),this.reverbKnob.fillCircle(s,i,20),this.reverbKnob.lineStyle(2,9323693,1),this.reverbKnob.strokeCircle(s,i,20),this.reverbKnob.fillStyle(2899536,1),this.reverbKnob.fillCircle(s,i,8),this.reverbPointer=this.scene.add.graphics(),this.reverbPointer.setScrollFactor(0),this.reverbPointer.setDepth(102),this.reverbLabel=this.scene.add.text(s,i+35,"REVERB",{fontSize:"10px",color:"#9b59b6",fontFamily:"Nabla, system-ui",stroke:"#000000",strokeThickness:1}),this.reverbLabel.setOrigin(.5,.5),this.reverbLabel.setScrollFactor(0),this.reverbLabel.setDepth(101),this.reverbValue=this.scene.add.text(s,i+50,"30%",{fontSize:"8px",color:"#ffffff",fontFamily:"Nabla, system-ui",stroke:"#000000",strokeThickness:1}),this.reverbValue.setOrigin(.5,.5),this.reverbValue.setScrollFactor(0),this.reverbValue.setDepth(101)}createWaveformSelector(){const{x:t,y:e}=this.config,s=t+380,i=e+45;this.waveformSelector=this.scene.add.graphics(),this.waveformSelector.setScrollFactor(0),this.waveformSelector.setDepth(101),this.waveformSelector.fillStyle(15965202,.8),this.waveformSelector.fillCircle(s,i,20),this.waveformSelector.lineStyle(2,15105570,1),this.waveformSelector.strokeCircle(s,i,20),this.waveformSelector.fillStyle(2899536,1),this.waveformSelector.fillCircle(s,i,8),this.waveformIcons=[],["⚡","⬜","△","∿"].forEach(((t,e)=>{const o=this.scene.add.text(s+15*(e-1.5),i+25,t,{fontSize:"8px",color:"#f39c12",fontFamily:"Nabla, system-ui"});o.setOrigin(.5,.5),o.setScrollFactor(0),o.setDepth(101),this.waveformIcons.push(o)})),this.waveformLabel=this.scene.add.text(s,i+35,"WAVE",{fontSize:"10px",color:"#f39c12",fontFamily:"Nabla, system-ui",stroke:"#000000",strokeThickness:1}),this.waveformLabel.setOrigin(.5,.5),this.waveformLabel.setScrollFactor(0),this.waveformLabel.setDepth(101),this.waveformValue=this.scene.add.text(s,i+50,"SAW",{fontSize:"8px",color:"#ffffff",fontFamily:"Nabla, system-ui",stroke:"#000000",strokeThickness:1}),this.waveformValue.setOrigin(.5,.5),this.waveformValue.setScrollFactor(0),this.waveformValue.setDepth(101)}update(){const t=this.audioManager.getLFORate(),e=this.audioManager.getChorusDepth(),s=this.audioManager.getDelayVolume(),i=this.audioManager.getReverbAmount(),o=this.audioManager.getCurrentWaveform();this.updateLFOKnob(t),this.updateChorusKnob(e),this.updateDelaySlider(s),this.updateReverbKnob(i),this.updateWaveformSelector(o)}updateLFOKnob(t){const{x:e,y:s}=this.config,i=e+60,o=s+45,a=(t/10*360-90)*(Math.PI/180);this.lfoPointer.clear(),this.lfoPointer.lineStyle(4,16777215,1),this.lfoPointer.beginPath(),this.lfoPointer.moveTo(i,o),this.lfoPointer.lineTo(i+18*Math.cos(a),o+18*Math.sin(a)),this.lfoPointer.strokePath(),this.lfoPointer.fillStyle(16777215,1),this.lfoPointer.fillCircle(i+18*Math.cos(a),o+18*Math.sin(a),3),this.lfoValue.setText(`${t.toFixed(1)}Hz`)}updateChorusKnob(t){const{x:e,y:s}=this.config,i=e+140,o=s+45,a=(360*t-90)*(Math.PI/180);this.chorusPointer.clear(),this.chorusPointer.lineStyle(4,16777215,1),this.chorusPointer.beginPath(),this.chorusPointer.moveTo(i,o),this.chorusPointer.lineTo(i+18*Math.cos(a),o+18*Math.sin(a)),this.chorusPointer.strokePath(),this.chorusPointer.fillStyle(16777215,1),this.chorusPointer.fillCircle(i+18*Math.cos(a),o+18*Math.sin(a),3),this.chorusValue.setText(`${(100*t).toFixed(0)}%`)}updateDelaySlider(t){const{x:e,y:s}=this.config,i=e+220,o=s+35,a=o+50*(1-t);this.delayHandle.clear(),this.delayHandle.fillStyle(0,.3),this.delayHandle.fillRoundedRect(i-5,a-2,12,6,3),this.delayHandle.fillStyle(3066993,1),this.delayHandle.fillRoundedRect(i-6,a-3,12,6,3),this.delayHandle.lineStyle(1,2600544,1),this.delayHandle.strokeRoundedRect(i-6,a-3,12,6,3),this.delayHandle.fillStyle(8577194,.8),this.delayHandle.fillRoundedRect(i-5,a-2,10,2,2),this.delayLEDs.clear();const r=Math.floor(10*t);for(let n=0;n<r;n++){const t=o+5+4*n;this.delayLEDs.fillStyle(0,.3),this.delayLEDs.fillRect(i-1,t+1,4,2),this.delayLEDs.fillStyle(3066993,.9),this.delayLEDs.fillRect(i-2,t,4,2),this.delayLEDs.fillStyle(8577194,.6),this.delayLEDs.fillRect(i-2,t,4,1)}this.delayValue.setText(`${(100*t).toFixed(0)}%`)}updateReverbKnob(t){const{x:e,y:s}=this.config,i=e+300,o=s+45,a=(360*t-90)*(Math.PI/180);this.reverbPointer.clear(),this.reverbPointer.lineStyle(4,16777215,1),this.reverbPointer.beginPath(),this.reverbPointer.moveTo(i,o),this.reverbPointer.lineTo(i+18*Math.cos(a),o+18*Math.sin(a)),this.reverbPointer.strokePath(),this.reverbPointer.fillStyle(16777215,1),this.reverbPointer.fillCircle(i+18*Math.cos(a),o+18*Math.sin(a),3),this.reverbValue.setText(`${(100*t).toFixed(0)}%`)}updateWaveformSelector(t){const e=["sawtooth","square","triangle","sine"].indexOf(t);e>=0&&this.waveformValue.setText(["SAW","SQR","TRI","SIN"][e]),this.waveformIcons.forEach(((t,s)=>{s===e?(t.setColor("#ffffff"),t.setScale(1.2)):(t.setColor("#f39c12"),t.setScale(1))}))}destroy(){var t,e,s,i,o,a,r,n,h,l,c,d,u,m,y,f,p,g,C,T,b,A,E,S;null==(t=this.panelBackground)||t.destroy(),null==(e=this.titleText)||e.destroy(),null==(s=this.lfoKnob)||s.destroy(),null==(i=this.lfoLabel)||i.destroy(),null==(o=this.lfoValue)||o.destroy(),null==(a=this.lfoPointer)||a.destroy(),null==(r=this.chorusKnob)||r.destroy(),null==(n=this.chorusLabel)||n.destroy(),null==(h=this.chorusValue)||h.destroy(),null==(l=this.chorusPointer)||l.destroy(),null==(c=this.delaySlider)||c.destroy(),null==(d=this.delayTrack)||d.destroy(),null==(u=this.delayHandle)||u.destroy(),null==(m=this.delayLabel)||m.destroy(),null==(y=this.delayValue)||y.destroy(),null==(f=this.delayLEDs)||f.destroy(),null==(p=this.reverbKnob)||p.destroy(),null==(g=this.reverbLabel)||g.destroy(),null==(C=this.reverbValue)||C.destroy(),null==(T=this.reverbPointer)||T.destroy(),null==(b=this.waveformSelector)||b.destroy(),null==(A=this.waveformLabel)||A.destroy(),null==(E=this.waveformValue)||E.destroy(),null==(S=this.waveformIcons)||S.forEach((t=>t.destroy())),this.animationTweens.forEach((t=>t.destroy())),this.animationTweens=[]}calculateScreenSize(){const{width:t,height:e}=this.scene.scale;return{width:t,height:e,scaleFactor:Math.min(Math.min(t/1024,e/768),1),isMobile:t<768,isTablet:t>=768&&t<1024,isDesktop:t>=1024}}updateScreenSize(){this.screenSize=this.calculateScreenSize()}updateLayout(){this.updateScreenSize(),this.updatePanelLayout(),this.updateControlLayouts()}updatePanelLayout(){const{width:t,height:e}=this.screenSize,{scaleFactor:s,isMobile:i,isTablet:o}=this.screenSize;let a,r,n,h;i?(a=Math.min(t-24,380),r=70,n=12,h=12):o?(a=Math.min(t-24,580),r=90,n=12,h=12):(a=Math.min(t-24,520),r=110,n=12,h=50),this.config={x:n,y:h,width:a,height:r},this.panelBackground&&(this.panelBackground.clear(),this.panelBackground.fillStyle(0,.4),this.panelBackground.fillRoundedRect(n+2,h+2,a,r,8),this.panelBackground.fillStyle(2899536,.95),this.panelBackground.fillRoundedRect(n,h,a,r,8),this.panelBackground.lineStyle(2,8359053,1),this.panelBackground.strokeRoundedRect(n,h,a,r,8),this.panelBackground.lineStyle(1,9807270,.6),this.panelBackground.strokeRoundedRect(n+1,h+1,a-2,r-2,6),this.panelBackground.lineStyle(1,12436423,.3),this.panelBackground.strokeRoundedRect(n+2,h+2,a-4,r-4,4)),this.titleText&&(this.titleText.setPosition(n+a/2,h+15),this.titleText.setScale(s))}updateControlLayouts(){const{scaleFactor:t,isMobile:e,isTablet:s}=this.screenSize,{x:i,y:o,width:a,height:r}=this.config;let n,h,l,c,d,u;e?(n=(a-40)/5,h=o+30,l=14,c=7,d=9,u=20):s?(n=(a-60)/5,h=o+40,l=18,c=8,d=10,u=25):(n=90,h=o+50,l=22,c=9,d=11,u=30),this.updateControlLayout("lfo",i+20+0*n,h,l,c,d,t,u),this.updateControlLayout("chorus",i+20+1*n,h,l,c,d,t,u),this.updateControlLayout("delay",i+20+2*n,h,l,c,d,t,u),this.updateControlLayout("reverb",i+20+3*n,h,l,c,d,t,u),this.updateControlLayout("waveform",i+20+4*n,h,l,c,d,t,u)}updateControlLayout(t,e,s,i,o,a,r,n){const h=this.getControlKnob(t);h&&(h.clear(),this.drawKnob(h,e,s,i,t));const l=this.getControlLabel(t);l&&(l.setPosition(e,s+i+12),l.setFontSize(`${a}px`),l.setScale(r));const c=this.getControlValue(t);c&&(c.setPosition(e,s+i+n),c.setFontSize(`${o}px`),c.setScale(r)),"delay"!==t&&"waveform"!==t&&this.getControlPointer(t)}drawKnob(t,e,s,i,o){const a={lfo:{fill:15965202,stroke:15105570,highlight:16243823},chorus:{fill:3447003,stroke:2719929,highlight:8765929},delay:{fill:3066993,stroke:2600544,highlight:8577194},reverb:{fill:10181046,stroke:9323693,highlight:12292046},waveform:{fill:15965202,stroke:15105570,highlight:16243823}}[o];t.fillStyle(0,.3),t.fillCircle(e+1,s+1,i),t.fillStyle(a.fill,.9),t.fillCircle(e,s,i),t.fillStyle(a.highlight,.6),t.fillCircle(e-.3*i,s-.3*i,.4*i),t.lineStyle(2,a.stroke,1),t.strokeCircle(e,s,i),t.fillStyle(2899536,1),t.fillCircle(e,s,.35*i),t.fillStyle(3426654,.8),t.fillCircle(e-.1*i,s-.1*i,.2*i)}getControlKnob(t){switch(t){case"lfo":return this.lfoKnob;case"chorus":return this.chorusKnob;case"delay":return this.delayTrack;case"reverb":return this.reverbKnob;case"waveform":return this.waveformSelector;default:return null}}getControlLabel(t){switch(t){case"lfo":return this.lfoLabel;case"chorus":return this.chorusLabel;case"delay":return this.delayLabel;case"reverb":return this.reverbLabel;case"waveform":return this.waveformLabel;default:return null}}getControlValue(t){switch(t){case"lfo":return this.lfoValue;case"chorus":return this.chorusValue;case"delay":return this.delayValue;case"reverb":return this.reverbValue;case"waveform":return this.waveformValue;default:return null}}getControlPointer(t){switch(t){case"lfo":return this.lfoPointer;case"chorus":return this.chorusPointer;case"reverb":return this.reverbPointer;default:return null}}}class g extends i.Scene{constructor(){super("MuseRunnerGame"),e(this,"character"),e(this,"scoreText"),e(this,"isGameRunning",!1),e(this,"score",0),e(this,"isGrounded",!1),e(this,"groundStartTime",0),e(this,"lastScoreDecayTime",0),e(this,"synthControlPanel"),e(this,"floatingPoints",[]),e(this,"floatingPointsFrameCount",0),e(this,"lastDetectedChord",null),e(this,"mathVisualBox"),e(this,"chordDisplayText"),e(this,"chordProgressBar"),e(this,"groundVisual"),e(this,"mathBackground"),e(this,"backgroundData",[]),e(this,"audioManager"),e(this,"inputManager"),e(this,"platformManager"),e(this,"chordDetector")}async create(){const{width:t,height:e}=this.cameras.main;try{this.audioManager=new h,this.inputManager=new l(this),this.platformManager=new c(this),this.chordDetector=new f(this),this.audioManager.initialize(),this.inputManager.initialize(),this.platformManager.initialize()}catch(i){console.error(r.ERROR_HANDLING.MANAGER_INIT_FAILED,i)}this.character=this.add.image(100,e-80,"player"),this.character.setOrigin(.5,1),this.character.setDepth(1e3),this.physics.add.existing(this.character);const s=this.character.body;s.setCollideWorldBounds(!1),s.setDragX(0),s.setFrictionX(0),s.setGravityY(0),this.scoreText=this.add.text(16,16,"Score: 0",{fontSize:"24px",color:"#ffffff",fontFamily:"Nabla, system-ui",stroke:"#000000",strokeThickness:2}),this.scoreText.setScrollFactor(0),this.synthControlPanel=new p(this,this.audioManager,{x:16,y:50,width:500,height:100}),this.synthControlPanel.create(),this.createMathVisualBox(),this.add.text(t-16,16,"v0.0.4 | ESC: Menu | T: Restart",{fontSize:"14px",color:"#95a5a6",fontFamily:"Nabla, system-ui"}).setOrigin(1,0).setScrollFactor(0),this.input.keyboard.on("keydown-ESC",(()=>{this.scene.start("MainMenu")})),this.input.keyboard.on("keydown-T",(()=>{this.scene.restart()})),this.isGameRunning=!0,this.cameras.main.startFollow(this.character,!0,r.GAME.CAMERA_FOLLOW_LERP_X,r.GAME.CAMERA_FOLLOW_LERP_Y),this.cameras.main.setDeadzone(r.GAME.CAMERA_DEADZONE_X,r.GAME.CAMERA_DEADZONE_Y),this.score=0,this.scale.on("resize",(t=>{this.synthControlPanel.updateLayout()}))}update(){if(!this.isGameRunning)return;const t=this.character.body;t.setVelocityX(r.CHARACTER.SPEED),t.setDragX(0),t.setFrictionX(0);try{const{keyStateChanged:t}=this.inputManager.update(this.time.now),e=this.inputManager.getInputState();this.inputManager.getArrowKeyState(),e.pressedKeys.has("5")&&(this.audioManager.updateLFORate(-.1),console.log("🎛️ Key 5 pressed - LFO Rate decreased")),e.pressedKeys.has("6")&&(this.audioManager.updateLFORate(.1),console.log("🎛️ Key 6 pressed - LFO Rate increased")),e.pressedKeys.has("7")&&(this.audioManager.updateChorusDepth(-.05),console.log("🎛️ Key 7 pressed - Chorus Depth decreased")),e.pressedKeys.has("8")&&(this.audioManager.updateChorusDepth(.05),console.log("🎛️ Key 8 pressed - Chorus Depth increased")),e.pressedKeys.has("1")&&this.audioManager.updateDelayVolume(-.05),e.pressedKeys.has("2")&&this.audioManager.updateDelayVolume(.05),e.pressedKeys.has("3")&&this.audioManager.updateReverbAmount(-.05),e.pressedKeys.has("4")&&this.audioManager.updateReverbAmount(.05),t&&e.pressedKeys.has("0")&&(this.audioManager.switchWaveform(),console.log("🎛️ Key 0 pressed - Waveform switched")),this.updateSynthesisDisplay(),t&&this.handleKeyChanges(e.pressedKeys);const s=this.chordDetector.update(e.pressedKeys);if(s.chordName||(this.lastDetectedChord=null),s.points>0){this.score+=s.points,this.scoreText.setText(`Score: ${Math.floor(this.score)}`);const t=this.chordDetector.getCurrentChord();t&&this.showFloatingPoints(t.accumulatedPoints,this.cameras.main.width/2,this.cameras.main.height/2),this.updateMathVisualBox(s.chordName,s.points),s.chordName&&s.chordName!==this.lastDetectedChord&&(this.showChordNameFloating(s.chordName),this.lastDetectedChord=s.chordName)}}catch(e){console.warn(r.ERROR_HANDLING.INPUT_HANDLING_ERROR,e)}try{this.platformManager.hasActivePlatforms()&&this.platformManager.extendActivePlatforms(this.character.x)}catch(e){console.warn(r.ERROR_HANDLING.PLATFORM_EXTENSION_ERROR,e)}try{this.updateCharacterHeight()}catch(e){console.warn(r.ERROR_HANDLING.CHARACTER_HEIGHT_ERROR,e)}this.updateMathBackground()}updateSynthesisDisplay(){this.synthControlPanel.update(),this.synthControlPanel.updateLayout(),this.character.y>this.cameras.main.height+r.GAME.OVER_FALL_DISTANCE&&this.gameOver();try{this.platformManager.cleanupOldPlatforms(this.character.x)}catch(t){console.warn(r.ERROR_HANDLING.PLATFORM_CLEANUP_ERROR,t)}}handleKeyChanges(t){try{const e=this.platformManager.getActivePlatforms();t.forEach((t=>{if(this.isValidGameKey(t)&&!e.has(t))try{this.platformManager.startNewPlatform(t,this.character.x),this.audioManager.playNote(t),this.character.setScale(1.2),this.time.delayedCall(r.CHARACTER.VISUAL_FEEDBACK_DURATION,(()=>{this.character.setScale(1)})),this.score+=r.GAME.SCORE_PER_PLATFORM,this.scoreText.setText(`Score: ${Math.floor(this.score)}`),this.showFloatingPoints(r.GAME.SCORE_PER_PLATFORM,this.cameras.main.width/2,this.cameras.main.height/2),this.createPlatformParticles(t,this.character.x)}catch(s){console.warn(`${r.ERROR_HANDLING.PLATFORM_START_ERROR} for key ${t}:`,s)}})),e.forEach(((e,s)=>{if(!t.has(s))try{this.platformManager.endPlatform(s),this.audioManager.stopNote(s)}catch(i){console.warn(`${r.ERROR_HANDLING.PLATFORM_END_ERROR} for key ${s}:`,i)}}))}catch(e){console.error(r.ERROR_HANDLING.KEY_CHANGE_ERROR,e)}}isValidGameKey(t){return r.VALID_KEYS.includes(t)}updateCharacterHeight(){const t=this.character.body,e=this.platformManager.getHighestActiveKey();if(e){this.isGrounded&&this.handleLeaveGround();const{height:s}=this.cameras.main,o=s+r.LEVEL_HEIGHTS[e],a=this.character.y,n=o-a;if(Math.abs(n)>.5){const e=i.Math.Linear(a,o,r.GAME.CHARACTER_HEIGHT_LERP_SPEED);this.character.y=e,t.setVelocityY(0)}else this.character.y=o,t.setVelocityY(0)}else{const{height:e}=this.cameras.main,s=e-20;this.character.y<s?t.setVelocityY(r.GAME.FALL_VELOCITY):(this.character.y=s,t.setVelocityY(0),this.isGrounded?this.handleStayGrounded():this.handleHitGround())}}handleHitGround(){this.isGrounded=!0,this.groundStartTime=this.time.now,this.lastScoreDecayTime=this.time.now,this.audioManager.playGroundC2(),this.character.setTint(6710886),console.log("🎵 Character hit ground - C2 base note started")}handleStayGrounded(){this.time.now-this.groundStartTime>r.GAME.GROUND_GRACE_PERIOD&&this.time.now-this.lastScoreDecayTime>=1e3&&(this.score-=r.GAME.SCORE_DECAY_RATE,this.score=Math.max(0,this.score),this.scoreText.setText(`Score: ${Math.floor(this.score)}`),this.lastScoreDecayTime=this.time.now,this.showFloatingPoints(-1,this.cameras.main.width/2,this.cameras.main.height/2),console.log("📉 Score decay: -1 point"))}handleLeaveGround(){this.isGrounded=!1,this.audioManager.stopGroundC2(),this.character.clearTint(),console.log("🎵 Character left ground - audio stopped")}showFloatingPoints(t,e,s){const i=this.add.text(e,s,`${t>0?"+":""}${t}`,{fontSize:"24px",color:this.getPointsColor(t),fontFamily:"Nabla, system-ui",stroke:"#000000",strokeThickness:2});i.setOrigin(.5),i.setScrollFactor(0),this.floatingPoints.push(i),this.createPointsParticles(e,s,t),this.animateFloatingPoints(i,t)}getPointsColor(t){return t<0?"#E74C3C":t>=100?"#FFD700":t>=50?"#9B59B6":t>=25?"#3498DB":"#2ECC71"}createPointsParticles(t,e,s){if(!(s>=100||10===s))return;const i=Math.min(s/10,8);for(let o=0;o<i;o++){const s=this.add.circle(t,e,2,16777215,.8);s.setScrollFactor(0);const a=2*Math.PI*o/i+.5*Math.random(),r=50+100*Math.random();this.tweens.add({targets:s,x:t+Math.cos(a)*r,y:e+Math.sin(a)*r,alpha:0,scale:0,duration:800+400*Math.random(),ease:"Power2",onComplete:()=>s.destroy()})}}animateFloatingPoints(t,e){let s=0;const i=()=>{if(s++,e%10==0&&s%10==0){const e=1.2+(s%20==0?.3:.1);this.tweens.add({targets:t,scaleX:e,scaleY:e,duration:100,yoyo:!0,ease:"Power2"})}s<60&&this.time.delayedCall(16,i)};i(),this.tweens.add({targets:t,y:t.y-100,alpha:0,rotation:.5*Math.random()-.25,duration:1500,ease:"Power2",onComplete:()=>{t.destroy();const e=this.floatingPoints.indexOf(t);e>-1&&this.floatingPoints.splice(e,1)}})}createMathVisualBox(){const{width:t,height:e}=this.cameras.main;this.mathVisualBox=this.add.rectangle(t/2,e-60,t-40,80,2899536,1),this.mathVisualBox.setScrollFactor(0),this.mathVisualBox.setStrokeStyle(2,3447003),this.chordDisplayText=this.add.text(t/2,e-80,"",{fontSize:"20px",color:"#ecf0f1",fontFamily:"Nabla, system-ui",stroke:"#000000",strokeThickness:1}),this.chordDisplayText.setOrigin(.5),this.chordDisplayText.setScrollFactor(0),this.chordDisplayText.setVisible(!1),this.add.rectangle(t/2,e-40,t-60,8,3426654).setScrollFactor(0),this.chordProgressBar=this.add.rectangle(t/2-(t-60)/2,e-40,0,8,3066993),this.chordProgressBar.setOrigin(0,.5),this.chordProgressBar.setScrollFactor(0),this.createMathBackground()}createPlatformParticles(t,e){const{height:s}=this.cameras.main,i=s+r.LEVEL_HEIGHTS[t],o=r.LEVEL_COLORS[t];for(let a=0;a<8;a++){const t=this.add.text(e,i,"♪",{fontSize:"12px",color:`#${o.toString(16).padStart(6,"0")}`,fontFamily:"Nabla, system-ui",stroke:"#FFFFFF",strokeThickness:1});t.setOrigin(.5);const s=2*Math.PI*a/8+.5*Math.random(),r=80+120*Math.random(),n=e+Math.cos(s)*r,h=i+Math.sin(s)*r;this.tweens.add({targets:t,x:n,y:h,alpha:0,scale:.3,rotation:Math.random()*Math.PI*2,duration:800+400*Math.random(),ease:"Power2",onComplete:()=>t.destroy()})}for(let a=0;a<5;a++){const t=this.add.circle(e,i,2,o,.8),s=2*Math.PI*a/5,r=60+80*Math.random(),n=e+Math.cos(s)*r,h=i+Math.sin(s)*r;this.tweens.add({targets:t,x:n,y:h,alpha:0,scale:0,duration:600+300*Math.random(),ease:"Power2",onComplete:()=>t.destroy()})}}updateMathVisualBox(t,e){}showChordNameFloating(t){const e=this.add.text(this.cameras.main.width/2,this.cameras.main.height/2-50,t,{fontSize:"28px",color:"#f39c12",fontFamily:"Nabla, system-ui",stroke:"#000000",strokeThickness:2});e.setOrigin(.5),e.setScrollFactor(0),this.tweens.add({targets:e,y:e.y-80,alpha:0,duration:3e3,ease:"Power2",onComplete:()=>e.destroy()})}showChordName(t,e){this.children.list.forEach((t=>{"chordName"===t.name&&t.destroy()}));const s=this.chordDetector.getCurrentChord(),i=s?s.accumulatedPoints:0,o=this.add.text(this.cameras.main.width/2,100,`${t} ${i}/${(null==s?void 0:s.basePoints)||0}`,{fontSize:"32px",color:"#f39c12",fontFamily:"Nabla, system-ui",stroke:"#000000",strokeThickness:2});o.setOrigin(.5),o.setScrollFactor(0),o.name="chordName",this.tweens.add({targets:o,alpha:0,y:o.y-50,duration:2e3,ease:"Power2",onComplete:()=>o.destroy()})}gameOver(){this.isGameRunning=!1;const{width:t,height:e}=this.cameras.main;this.cameras.main.stopFollow(),this.add.rectangle(this.cameras.main.scrollX+t/2,this.cameras.main.scrollY+e/2,t,e,0,.8).setScrollFactor(0),this.add.text(this.cameras.main.scrollX+t/2,this.cameras.main.scrollY+e/2-80,"Game Over!",{fontSize:"48px",color:"#e74c3c",fontFamily:"Arial, sans-serif"}).setOrigin(.5).setScrollFactor(0),this.add.text(this.cameras.main.scrollX+t/2,this.cameras.main.scrollY+e/2-20,`Final Score: ${Math.floor(this.score)}`,{fontSize:"24px",color:"#ffffff",fontFamily:"Arial, sans-serif"}).setOrigin(.5).setScrollFactor(0);const s=this.add.text(this.cameras.main.scrollX+t/2,this.cameras.main.scrollY+e/2+30,"Press T to restart or ESC for menu",{fontSize:"18px",color:"#bdc3c7",fontFamily:"Arial, sans-serif"}).setOrigin(.5).setScrollFactor(0);this.tweens.add({targets:s,alpha:.5,duration:1e3,yoyo:!0,repeat:-1}),window.parent&&window.parent.postMessage({type:"GAME_OVER",data:{finalScore:Math.floor(this.score)}},"*")}createMathBackground(){const{width:t,height:e}=this.cameras.main;this.mathBackground=this.add.graphics(),this.mathBackground.setScrollFactor(0),this.mathBackground.setDepth(1);const s=t-40;this.backgroundData=[];for(let i=0;i<80;i++){this.backgroundData[i]=[];for(let t=0;t<s;t++)this.backgroundData[i][t]=0}}updateMathBackground(){if(!this.mathBackground)return;const{width:t,height:e}=this.cameras.main,s=t-40,o=e-100,a=this.audioManager.getLFORate(),r=this.audioManager.getChorusDepth(),n=this.audioManager.getDelayVolume(),h=this.audioManager.getReverbAmount(),l=this.platformManager.getActivePlatforms(),c=.001*this.time.now;this.mathBackground.clear();for(let d=0;d<80;d++)for(let t=0;t<s;t++){let e,s=0;s+=.8*Math.sin(t*a*.1+c),s+=.6*Math.cos(d*r*.1+c),s+=.4*Math.sin((t+d)*n*.05+c),s+=.3*Math.tan(t*h*.02+c),l.forEach(((e,i)=>{const o=this.getNoteFrequency(i);o&&(s+=.5*Math.sin(t*o*.001+c),s+=.5*Math.cos(d*o*.001+c))})),s=(s+1)/2,e=s<.25?i.Display.Color.Interpolate.ColorWithColor({r:0,g:0,b:255},{r:0,g:255,b:255},100,s/.25*100):s<.5?i.Display.Color.Interpolate.ColorWithColor({r:0,g:255,b:255},{r:0,g:255,b:0},100,(s-.25)/.25*100):s<.75?i.Display.Color.Interpolate.ColorWithColor({r:0,g:255,b:0},{r:255,g:255,b:0},100,(s-.5)/.25*100):i.Display.Color.Interpolate.ColorWithColor({r:255,g:255,b:0},{r:255,g:0,b:0},100,(s-.75)/.25*100),this.mathBackground.fillStyle(i.Display.Color.GetColor(e.r,e.g,e.b),.7),this.mathBackground.fillRect(20+t,o+d,1,1)}}getNoteFrequency(t){return{S:261.63,D:293.66,F:329.63,G:349.23,H:392,J:440,K:493.88,R:311.13,U:415.3,I:466.16,A:246.94,L:523.25,";":587.33,"'":659.25}[t]||null}}class C extends i.Scene{constructor(){super("MainMenu"),e(this,"title",null),e(this,"subtitle",null),e(this,"instructions",null),e(this,"startText",null),e(this,"credits",null)}init(){this.title=null,this.subtitle=null,this.instructions=null,this.startText=null,this.credits=null}create(){this.refreshLayout(),this.scale.on("resize",(()=>this.refreshLayout())),this.input.once("pointerdown",(()=>{this.scene.start("MuseRunnerGame")})),this.input.keyboard.on("keydown-SPACE",(()=>{this.scene.start("MuseRunnerGame")}))}refreshLayout(){const{width:t,height:e}=this.scale;this.cameras.resize(t,e),this.add.rectangle(t/2,e/2,t,e,2899536);const s=Math.min(t/1024,e/768);this.title||(this.title=this.add.text(0,0,"🎵 Muse Runner 🏃‍♂️",{fontSize:"48px",color:"#ffffff",fontFamily:"Nabla, system-ui"}).setOrigin(.5)),this.title.setPosition(t/2,e/3),this.title.setScale(s),this.subtitle||(this.subtitle=this.add.text(0,0,"Rhythm Platformer",{fontSize:"24px",color:"#3498db",fontFamily:"Nabla, system-ui"}).setOrigin(.5)),this.subtitle.setPosition(t/2,e/3+60*s),this.subtitle.setScale(s),this.instructions||(this.instructions=this.add.text(0,0,"Control your character by playing musical notes!\n\nPress S-D-F-G-H-J-K keys to create platforms\nKeep your character from falling off the screen",{fontSize:"18px",color:"#ecf0f1",fontFamily:"Nabla, system-ui",align:"center"}).setOrigin(.5)),this.instructions.setPosition(t/2,e/2),this.instructions.setScale(s),this.startText||(this.startText=this.add.text(0,0,"Click to Start or Press SPACE",{fontSize:"24px",color:"#2ecc71",fontFamily:"Nabla, system-ui"}).setOrigin(.5),this.tweens.add({targets:this.startText,alpha:.5,duration:1e3,yoyo:!0,repeat:-1})),this.startText.setPosition(t/2,.75*e),this.startText.setScale(s),this.credits||(this.credits=this.add.text(0,0,"v0.0.4 - Built with Phaser.js for Reddit's Community Games Challenge",{fontSize:"14px",color:"#95a5a6",fontFamily:"Nabla, system-ui"}).setOrigin(.5)),this.credits.setPosition(t/2,e-40),this.credits.setScale(.8*s)}}class T extends i.Scene{constructor(){super("Preloader")}init(){}preload(){this.load.setPath("assets"),this.load.image("logo","logo.png"),this.load.image("player","player.png"),this.load.setPath("assets/fonts"),this.load.font("nabla","nabla.ttf")}create(){this.scene.start("MainMenu")}}const b={type:i.AUTO,parent:"game-container",backgroundColor:"#2c3e50",physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!1}},scale:{mode:i.Scale.RESIZE,autoCenter:i.Scale.CENTER_BOTH,width:1024,height:768},scene:[o,T,C,g,a]};document.addEventListener("DOMContentLoaded",(()=>{new i.Game({...b,parent:"game-container"})}));
//# sourceMappingURL=index-BUF07VW0.js.map
