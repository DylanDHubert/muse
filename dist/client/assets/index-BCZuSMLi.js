var t=Object.defineProperty,e=(e,s,i)=>((e,s,i)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i)(e,"symbol"!=typeof s?s+"":s,i);import{r as s}from"./phaser-CRaLQf_f.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const s of t)if("childList"===s.type)for(const t of s.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();var i=s();class a extends i.Scene{constructor(){super("Boot")}preload(){this.load.image("background","assets/bg.png")}create(){this.scene.start("Preloader")}}class r extends i.Scene{constructor(){super("GameOver"),e(this,"camera"),e(this,"background"),e(this,"gameOverText")}create(){this.camera=this.cameras.main,this.camera.setBackgroundColor(16711680),this.background=this.add.image(0,0,"background").setOrigin(0).setAlpha(.5),this.gameOverText=this.add.text(0,0,"Game Over",{fontFamily:"Arial Black",fontSize:"64px",color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.updateLayout(this.scale.width,this.scale.height),this.scale.on("resize",(t=>{const{width:e,height:s}=t;this.updateLayout(e,s)})),this.input.once("pointerdown",(()=>{this.scene.start("MainMenu")}))}updateLayout(t,e){this.cameras.resize(t,e),this.background&&this.background.setDisplaySize(t,e);const s=Math.min(Math.min(t/1024,e/768),1);this.gameOverText&&(this.gameOverText.setPosition(t/2,e/2),this.gameOverText.setScale(s))}}const n={CHARACTER:{SPEED:100,WIDTH:30,HEIGHT:40,COLOR:3447003,VISUAL_FEEDBACK_COLOR:15965202,VISUAL_FEEDBACK_DURATION:200},PLATFORMS:{WIDTH:120,HEIGHT:20,EXTENSION_DISTANCE:150,AHEAD_OFFSET:20,CLEANUP_DISTANCE:400},AUDIO:{NOTE_DURATION:.5,ATTACK_TIME:.01,VOLUME:.3},GAME:{OVER_FALL_DISTANCE:300,SCORE_PER_PLATFORM:10,GROUND_OFFSET:60,CHARACTER_HEIGHT_LERP_SPEED:.08,FALL_VELOCITY:300,CAMERA_DEADZONE_X:200,CAMERA_DEADZONE_Y:100,CAMERA_FOLLOW_LERP_X:.1,CAMERA_FOLLOW_LERP_Y:.1},LEVEL_HEIGHTS:{S:-80,D:-120,F:-160,G:-200,H:-240,J:-280,K:-320},LEVEL_COLORS:{S:15158332,D:15965202,F:15844367,G:3066993,H:3447003,J:10181046,K:15277667},VALID_KEYS:["S","D","F","G","H","J","K"],ERROR_HANDLING:{MANAGER_INIT_FAILED:"Failed to initialize managers",INPUT_HANDLING_ERROR:"Input handling error",PLATFORM_EXTENSION_ERROR:"Platform extension error",CHARACTER_HEIGHT_ERROR:"Character height update error",PLATFORM_CLEANUP_ERROR:"Platform cleanup error",KEY_CHANGE_ERROR:"Key change handling error",PLATFORM_START_ERROR:"Failed to start platform",PLATFORM_END_ERROR:"Failed to end platform"}},o={S:261.63,D:293.66,F:329.63,G:349.23,H:392,J:440,K:493.88};class c{constructor(){e(this,"audioContext",null),e(this,"isInitialized",!1),e(this,"audioAvailable",!1)}initialize(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.audioAvailable=!0,this.isInitialized=!0}catch(t){console.warn("Web Audio API not available:",t),this.audioAvailable=!1,this.isInitialized=!0}}playNote(t){if(!this.isInitialized)return void console.warn("AudioManager not initialized");if(!this.audioAvailable||!this.audioContext)return;const e=o[t];if(e)try{this.playMusicalTone(e)}catch(s){console.warn("Failed to play note:",s)}else console.warn(`Unknown key: ${t}`)}isAudioAvailable(){return this.audioAvailable}playMusicalTone(t){if(!this.audioContext)return;const e=this.audioContext.createOscillator(),s=this.audioContext.createGain();e.connect(s),s.connect(this.audioContext.destination),e.frequency.setValueAtTime(t,this.audioContext.currentTime),e.type="sine",s.gain.setValueAtTime(0,this.audioContext.currentTime),s.gain.linearRampToValueAtTime(n.AUDIO.VOLUME,this.audioContext.currentTime+n.AUDIO.ATTACK_TIME),s.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+n.AUDIO.NOTE_DURATION),e.start(this.audioContext.currentTime),e.stop(this.audioContext.currentTime+n.AUDIO.NOTE_DURATION)}}class h{constructor(t){e(this,"scene"),e(this,"currentlyPressedKeys",new Set),e(this,"previouslyPressedKeys",new Set),e(this,"isInitialized",!1),e(this,"keyObjects",new Map),this.scene=t}initialize(){this.scene.input.keyboard?(n.VALID_KEYS.forEach((t=>{this.keyObjects.set(t,this.scene.input.keyboard.addKey(t))})),this.isInitialized=!0):console.warn("Keyboard input not available")}update(t){return this.isInitialized&&this.scene.input.keyboard?(this.previouslyPressedKeys=new Set(this.currentlyPressedKeys),this.currentlyPressedKeys.clear(),n.VALID_KEYS.forEach((t=>{const e=this.keyObjects.get(t);e&&e.isDown&&this.currentlyPressedKeys.add(t)})),{keyStateChanged:this.hasKeyStateChanged()}):{keyStateChanged:!1}}getInputState(){return{pressedKeys:new Set(this.currentlyPressedKeys)}}hasKeyStateChanged(){if(this.currentlyPressedKeys.size!==this.previouslyPressedKeys.size)return!0;for(const t of this.currentlyPressedKeys)if(!this.previouslyPressedKeys.has(t))return!0;for(const t of this.previouslyPressedKeys)if(!this.currentlyPressedKeys.has(t))return!0;return!1}isValidGameKey(t){return n.VALID_KEYS.includes(t)}}class l{constructor(t){e(this,"scene"),e(this,"activePlatforms",new Map),e(this,"platformsGroup"),e(this,"isInitialized",!1),this.scene=t,this.platformsGroup=this.scene.add.group()}initialize(){this.isInitialized=!0}startNewPlatform(t,e){if(!this.isInitialized)return void console.warn("PlatformManager not initialized");if(this.activePlatforms.has(t))return;const{height:s}=this.scene.cameras.main,i=s+n.LEVEL_HEIGHTS[t],a=n.LEVEL_COLORS[t],r=this.scene.add.rectangle(e+n.PLATFORMS.AHEAD_OFFSET,i,n.PLATFORMS.WIDTH,n.PLATFORMS.HEIGHT,a);this.scene.physics.add.existing(r,!0);const o={rectangle:r,startX:e,key:t};this.activePlatforms.set(t,o),this.platformsGroup.add(r)}endPlatform(t){this.activePlatforms.get(t)&&this.activePlatforms.delete(t)}extendActivePlatforms(t){this.activePlatforms.forEach(((e,s)=>{const i=e.rectangle,a=t+n.PLATFORMS.EXTENSION_DISTANCE;if(a>i.x+i.width/2){const t=i.x-i.width/2,e=a-t,s=t+e/2;i.setSize(e,i.height),i.setPosition(s,i.y)}}))}getHighestActiveKey(){if(0===this.activePlatforms.size)return null;let t=null,e=Number.POSITIVE_INFINITY;return this.activePlatforms.forEach(((s,i)=>{const a=n.LEVEL_HEIGHTS[i];a<e&&(e=a,t=i)})),t}hasActivePlatforms(){return this.activePlatforms.size>0}cleanupOldPlatforms(t){const e=[];this.platformsGroup.children.entries.forEach((s=>{const i=s;i.x+i.width/2<t-n.PLATFORMS.CLEANUP_DISTANCE&&e.push(i)})),e.forEach((t=>{this.platformsGroup.remove(t),t.destroy()}))}getActivePlatforms(){return new Map(this.activePlatforms)}getPlatformsGroup(){return this.platformsGroup}getLevelHeight(t){return n.LEVEL_HEIGHTS[t]}getLevelColor(t){return n.LEVEL_COLORS[t]}}class d extends i.Scene{constructor(){super("MuseRunnerGame"),e(this,"character"),e(this,"scoreText"),e(this,"isGameRunning",!1),e(this,"score",0),e(this,"audioManager"),e(this,"inputManager"),e(this,"platformManager")}async create(){const{width:t,height:e}=this.cameras.main;try{this.audioManager=new c,this.inputManager=new h(this),this.platformManager=new l(this),this.audioManager.initialize(),this.inputManager.initialize(),this.platformManager.initialize()}catch(a){console.error(n.ERROR_HANDLING.MANAGER_INIT_FAILED,a)}this.character=this.add.rectangle(100,e-80,n.CHARACTER.WIDTH,n.CHARACTER.HEIGHT,n.CHARACTER.COLOR),this.physics.add.existing(this.character);const s=this.character.body;s.setCollideWorldBounds(!1),s.setDragX(0),s.setFrictionX(0),s.setGravityY(0),this.scoreText=this.add.text(16,16,"Score: 0",{fontSize:"24px",color:"#ffffff"});const i=this.add.text(t/2,30,"🎵 Press S-D-F-G-H-J-K to create platforms at different heights! 🎵",{fontSize:"16px",color:"#ecf0f1",fontFamily:"Arial, sans-serif"}).setOrigin(.5);this.add.text(t/2,60,"S=Low → D → F → G → H → J → K=High",{fontSize:"14px",color:"#95a5a6",fontFamily:"Arial, sans-serif"}).setOrigin(.5),this.tweens.add({targets:i,alpha:.6,duration:1500,yoyo:!0,repeat:-1}),this.add.text(t-16,16,"v0.0.4 | ESC: Menu | R: Restart",{fontSize:"14px",color:"#95a5a6"}).setOrigin(1,0),this.input.keyboard.on("keydown-ESC",(()=>{this.scene.start("MainMenu")})),this.input.keyboard.on("keydown-R",(()=>{this.scene.restart()})),this.isGameRunning=!0,this.cameras.main.startFollow(this.character,!0,n.GAME.CAMERA_FOLLOW_LERP_X,n.GAME.CAMERA_FOLLOW_LERP_Y),this.cameras.main.setDeadzone(n.GAME.CAMERA_DEADZONE_X,n.GAME.CAMERA_DEADZONE_Y),this.score=0}update(){if(!this.isGameRunning)return;const t=this.character.body;t.setVelocityX(n.CHARACTER.SPEED),t.setDragX(0),t.setFrictionX(0);try{const{keyStateChanged:t}=this.inputManager.update(this.time.now),e=this.inputManager.getInputState();t&&this.handleKeyChanges(e.pressedKeys)}catch(e){console.warn(n.ERROR_HANDLING.INPUT_HANDLING_ERROR,e)}try{this.platformManager.hasActivePlatforms()&&this.platformManager.extendActivePlatforms(this.character.x)}catch(e){console.warn(n.ERROR_HANDLING.PLATFORM_EXTENSION_ERROR,e)}try{this.updateCharacterHeight()}catch(e){console.warn(n.ERROR_HANDLING.CHARACTER_HEIGHT_ERROR,e)}this.character.y>this.cameras.main.height+n.GAME.OVER_FALL_DISTANCE&&this.gameOver();try{this.platformManager.cleanupOldPlatforms(this.character.x)}catch(e){console.warn(n.ERROR_HANDLING.PLATFORM_CLEANUP_ERROR,e)}}handleKeyChanges(t){try{const e=this.platformManager.getActivePlatforms();t.forEach((t=>{if(this.isValidGameKey(t)&&!e.has(t))try{this.platformManager.startNewPlatform(t,this.character.x),this.audioManager.playNote(t),this.character.setFillStyle(n.CHARACTER.VISUAL_FEEDBACK_COLOR),this.time.delayedCall(n.CHARACTER.VISUAL_FEEDBACK_DURATION,(()=>{this.character.setFillStyle(n.CHARACTER.COLOR)})),this.score+=n.GAME.SCORE_PER_PLATFORM,this.scoreText.setText(`Score: ${Math.floor(this.score)}`)}catch(s){console.warn(`${n.ERROR_HANDLING.PLATFORM_START_ERROR} for key ${t}:`,s)}})),e.forEach(((e,s)=>{if(!t.has(s))try{this.platformManager.endPlatform(s)}catch(i){console.warn(`${n.ERROR_HANDLING.PLATFORM_END_ERROR} for key ${s}:`,i)}}))}catch(e){console.error(n.ERROR_HANDLING.KEY_CHANGE_ERROR,e)}}isValidGameKey(t){return n.VALID_KEYS.includes(t)}updateCharacterHeight(){const t=this.character.body,e=this.platformManager.getHighestActiveKey();if(e){const{height:s}=this.cameras.main,a=s+n.LEVEL_HEIGHTS[e],r=this.character.y,o=a-r;if(Math.abs(o)>.5){const e=i.Math.Linear(r,a,n.GAME.CHARACTER_HEIGHT_LERP_SPEED);this.character.y=e,t.setVelocityY(0)}else this.character.y=a,t.setVelocityY(0)}else{const{height:e}=this.cameras.main,s=e-n.GAME.GROUND_OFFSET;this.character.y<s?t.setVelocityY(n.GAME.FALL_VELOCITY):(this.character.y=s,t.setVelocityY(0))}}gameOver(){this.isGameRunning=!1;const{width:t,height:e}=this.cameras.main;this.cameras.main.stopFollow(),this.add.rectangle(this.cameras.main.scrollX+t/2,this.cameras.main.scrollY+e/2,t,e,0,.8).setScrollFactor(0),this.add.text(this.cameras.main.scrollX+t/2,this.cameras.main.scrollY+e/2-80,"Game Over!",{fontSize:"48px",color:"#e74c3c",fontFamily:"Arial, sans-serif"}).setOrigin(.5).setScrollFactor(0),this.add.text(this.cameras.main.scrollX+t/2,this.cameras.main.scrollY+e/2-20,`Final Score: ${Math.floor(this.score)}`,{fontSize:"24px",color:"#ffffff",fontFamily:"Arial, sans-serif"}).setOrigin(.5).setScrollFactor(0);const s=this.add.text(this.cameras.main.scrollX+t/2,this.cameras.main.scrollY+e/2+30,"Press R to restart or ESC for menu",{fontSize:"18px",color:"#bdc3c7",fontFamily:"Arial, sans-serif"}).setOrigin(.5).setScrollFactor(0);this.tweens.add({targets:s,alpha:.5,duration:1e3,yoyo:!0,repeat:-1}),window.parent&&window.parent.postMessage({type:"GAME_OVER",data:{finalScore:Math.floor(this.score)}},"*")}}class u extends i.Scene{constructor(){super("MainMenu"),e(this,"title",null),e(this,"subtitle",null),e(this,"instructions",null),e(this,"startText",null),e(this,"credits",null)}init(){this.title=null,this.subtitle=null,this.instructions=null,this.startText=null,this.credits=null}create(){this.refreshLayout(),this.scale.on("resize",(()=>this.refreshLayout())),this.input.once("pointerdown",(()=>{this.scene.start("MuseRunnerGame")})),this.input.keyboard.on("keydown-SPACE",(()=>{this.scene.start("MuseRunnerGame")}))}refreshLayout(){const{width:t,height:e}=this.scale;this.cameras.resize(t,e),this.add.rectangle(t/2,e/2,t,e,2899536);const s=Math.min(t/1024,e/768);this.title||(this.title=this.add.text(0,0,"🎵 Muse Runner 🏃‍♂️",{fontSize:"48px",color:"#ffffff",fontFamily:"Arial, sans-serif"}).setOrigin(.5)),this.title.setPosition(t/2,e/3),this.title.setScale(s),this.subtitle||(this.subtitle=this.add.text(0,0,"Rhythm Platformer",{fontSize:"24px",color:"#3498db",fontFamily:"Arial, sans-serif"}).setOrigin(.5)),this.subtitle.setPosition(t/2,e/3+60*s),this.subtitle.setScale(s),this.instructions||(this.instructions=this.add.text(0,0,"Control your character by playing musical notes!\n\nPress S-D-F-G-H-J-K keys to create platforms\nKeep your character from falling off the screen",{fontSize:"18px",color:"#ecf0f1",fontFamily:"Arial, sans-serif",align:"center"}).setOrigin(.5)),this.instructions.setPosition(t/2,e/2),this.instructions.setScale(s),this.startText||(this.startText=this.add.text(0,0,"Click to Start or Press SPACE",{fontSize:"24px",color:"#2ecc71",fontFamily:"Arial, sans-serif"}).setOrigin(.5),this.tweens.add({targets:this.startText,alpha:.5,duration:1e3,yoyo:!0,repeat:-1})),this.startText.setPosition(t/2,.75*e),this.startText.setScale(s),this.credits||(this.credits=this.add.text(0,0,"v0.0.4 - Built with Phaser.js for Reddit's Community Games Challenge",{fontSize:"14px",color:"#95a5a6",fontFamily:"Arial, sans-serif"}).setOrigin(.5)),this.credits.setPosition(t/2,e-40),this.credits.setScale(.8*s)}}class E extends i.Scene{constructor(){super("Preloader")}init(){this.add.image(512,384,"background"),this.add.rectangle(512,384,468,32).setStrokeStyle(1,16777215);const t=this.add.rectangle(282,384,4,28,16777215);this.load.on("progress",(e=>{t.width=4+460*e}))}preload(){this.load.setPath("assets"),this.load.image("logo","logo.png")}create(){this.scene.start("MainMenu")}}const f={type:i.AUTO,parent:"game-container",backgroundColor:"#2c3e50",physics:{default:"arcade",arcade:{gravity:{x:0,y:0},debug:!1}},scale:{mode:i.Scale.RESIZE,autoCenter:i.Scale.CENTER_BOTH,width:1024,height:768},scene:[a,E,u,d,r]};document.addEventListener("DOMContentLoaded",(()=>{new i.Game({...f,parent:"game-container"})}));
//# sourceMappingURL=index-BCZuSMLi.js.map
